!function(a){a.Jcrop=function(c,h){function g(n){return Math.round(n)+"px"}function b(a){return U.baseClass+"-"+a}function w(){return a.fx.step.hasOwnProperty("backgroundColor")}function v(c){var h=a(c).offset();return[h.left,h.top]}function y(e){return[e.pageX-Q[0],e.pageY-Q[1]]}function C(c){"object"!=typeof c&&(c={}),U=a.extend(U,c),a.each(["onChange","onSelect","onRelease","onDblClick"],function(i,e){"function"!=typeof U[e]&&(U[e]=function(){})})}function S(a,c,h){if(Q=v(it),Ht.setCursor("move"===a?a:a+"-resize"),"move"===a)return Ht.activateHandlers(z(c),H,h);var g=Ot.getFixed(),b=M(a),w=Ot.getCorner(M(b));Ot.setPressed(Ot.getCorner(b)),Ot.setCurrent(w),Ht.activateHandlers(k(a,g),H,h)}function k(a,f){return function(c){if(U.aspectRatio)switch(a){case"e":c[1]=f.y+1;break;case"w":c[1]=f.y+1;break;case"n":c[0]=f.x+1;break;case"s":c[0]=f.x+1}else switch(a){case"e":c[1]=f.y2;break;case"w":c[1]=f.y2;break;case"n":c[0]=f.x2;break;case"s":c[0]=f.x2}Ot.setCurrent(c),Ft.update()}}function z(a){var c=a;return Dt.watchKeys(),function(a){Ot.moveOffset([a[0]-c[0],a[1]-c[1]]),c=a,Ft.update()}}function M(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function O(a){return function(e){return U.disabled?!1:"move"!==a||U.allowMove?(Q=v(it),yt=!0,S(a,y(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function j(a,c,h){var g=a.width(),b=a.height();g>c&&c>0&&(g=c,b=c/a.width()*a.height()),b>h&&h>0&&(b=h,g=h/a.height()*a.width()),wt=a.width()/g,vt=a.height()/b,a.width(g).height(b)}function F(a){return{x:a.x*wt,y:a.y*vt,x2:a.x2*wt,y2:a.y2*vt,w:a.w*wt,h:a.h*vt}}function H(){var a=Ot.getFixed();a.w>U.minSelect[0]&&a.h>U.minSelect[1]?(Ft.enableHandles(),Ft.done()):Ft.release(),Ht.setCursor(U.allowSelect?"crosshair":"default")}function D(e){if(U.disabled)return!1;if(!U.allowSelect)return!1;yt=!0,Q=v(it),Ft.disableHandles(),Ht.setCursor("crosshair");var a=y(e);return Ot.setPressed(a),Ft.update(),Ht.activateHandlers(I,H,"touch"===e.type.substring(0,5)),Dt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function I(a){Ot.setCurrent(a),Ft.update()}function B(){var c=a("<div></div>").addClass(b("tracker"));return $&&c.css({opacity:0,backgroundColor:"white"}),c}function P(a){ct.removeClass().addClass(b("holder")).addClass(a)}function J(a,c){function h(){window.setTimeout(I,z)}var g=a[0]/wt,b=a[1]/vt,w=a[2]/wt,v=a[3]/vt;if(!mt){var y=Ot.flipCoords(g,b,w,v),C=Ot.getFixed(),S=[C.x,C.y,C.x2,C.y2],k=S,z=U.animationDelay,M=y[0]-S[0],O=y[1]-S[1],j=y[2]-S[2],F=y[3]-S[3],H=0,D=U.swingSpeed;g=k[0],b=k[1],w=k[2],v=k[3],Ft.animMode(!0);var I=function(){return function(){H+=(100-H)/D,k[0]=Math.round(g+H/100*M),k[1]=Math.round(b+H/100*O),k[2]=Math.round(w+H/100*j),k[3]=Math.round(v+H/100*F),H>=99.8&&(H=100),100>H?(R(k),h()):(Ft.done(),Ft.animMode(!1),"function"==typeof c&&c.call(It))}}();h()}}function A(a){R([a[0]/wt,a[1]/vt,a[2]/wt,a[3]/vt]),U.onSelect.call(It,F(Ot.getFixed())),Ft.enableHandles()}function R(l){Ot.setPressed([l[0],l[1]]),Ot.setCurrent([l[2],l[3]]),Ft.update()}function T(){return F(Ot.getFixed())}function K(){return Ot.getFixed()}function E(a){C(a),V()}function W(){U.disabled=!0,Ft.disableHandles(),Ft.setCursor("default"),Ht.setCursor("default")}function Y(){U.disabled=!1,V()}function L(){Ft.done(),Ht.activateHandlers(null,null)}function X(){ct.remove(),tt.show(),tt.css("visibility","visible"),a(c).removeData("Jcrop")}function G(a,c){Ft.release(),W();var h=new Image;h.onload=function(){var g=h.width,b=h.height,w=U.boxWidth,v=U.boxHeight;it.width(g).height(b),it.attr("src",a),ut.attr("src",a),j(it,w,v),at=it.width(),st=it.height(),ut.width(at).height(st),St.width(at+2*Ct).height(st+2*Ct),ct.width(at).height(st),jt.resize(at,st),Y(),"function"==typeof c&&c.call(It)},h.src=a}function N(a,c,h){var g=c||U.bgColor;U.bgFade&&w()&&U.fadeTime&&!h?a.animate({backgroundColor:g},{queue:!1,duration:U.fadeTime}):a.css("backgroundColor",g)}function V(a){U.allowResize?a?Ft.enableOnly():Ft.enableHandles():Ft.disableHandles(),Ht.setCursor(U.allowSelect?"crosshair":"default"),Ft.setCursor(U.allowMove?"move":"default"),U.hasOwnProperty("trueSize")&&(wt=U.trueSize[0]/at,vt=U.trueSize[1]/st),U.hasOwnProperty("setSelect")&&(A(U.setSelect),Ft.done(),delete U.setSelect),jt.refresh(),U.bgColor!=kt&&(N(U.shade?jt.getShades():ct,U.shade?U.shadeColor||U.bgColor:U.bgColor),kt=U.bgColor),zt!=U.bgOpacity&&(zt=U.bgOpacity,U.shade?jt.refresh():Ft.setBgOpacity(zt)),ft=U.maxSize[0]||0,pt=U.maxSize[1]||0,gt=U.minSize[0]||0,bt=U.minSize[1]||0,U.hasOwnProperty("outerImage")&&(it.attr("src",U.outerImage),delete U.outerImage),Ft.refresh()}var Q,U=a.extend({},a.Jcrop.defaults),Z=navigator.userAgent.toLowerCase(),$=/msie/.test(Z),_=/msie [1-6]\./.test(Z);"object"!=typeof c&&(c=a(c)[0]),"object"!=typeof h&&(h={}),C(h);var et={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},tt=a(c),nt=!0;if("IMG"==c.tagName){if(0!=tt[0].width&&0!=tt[0].height)tt.width(tt[0].width),tt.height(tt[0].height);else{var ot=new Image;ot.src=tt[0].src,tt.width(ot.width),tt.height(ot.height)}var it=tt.clone().removeAttr("id").css(et).show();it.width(tt.width()),it.height(tt.height()),tt.after(it).hide()}else it=tt.css(et).show(),nt=!1,null===U.shade&&(U.shade=!0);j(it,U.boxWidth,U.boxHeight);var at=it.width(),st=it.height(),ct=a("<div />").width(at).height(st).addClass(b("holder")).css({position:"relative",backgroundColor:U.bgColor}).insertAfter(tt).append(it);U.addClass&&ct.addClass(U.addClass);var ut=a("<div />"),dt=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),lt=a("<div />").width("100%").height("100%").css("zIndex",320),ht=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=Ot.getFixed();U.onDblClick.call(It,a)}).insertBefore(it).append(dt,lt);nt&&(ut=a("<img />").attr("src",it.attr("src")).css(et).width(at).height(st),dt.append(ut)),_&&ht.css({overflowY:"hidden"});var ft,pt,gt,bt,wt,vt,yt,mt,xt,Ct=U.boundary,St=B().width(at+2*Ct).height(st+2*Ct).css({position:"absolute",top:g(-Ct),left:g(-Ct),zIndex:290}).mousedown(D),kt=U.bgColor,zt=U.bgOpacity;Q=v(it);var Mt=function(){function a(){var i,a={},c=["touchstart","touchmove","touchend"],h=document.createElement("div");try{for(i=0;i<c.length;i++){var g=c[i];g="on"+g;var b=g in h;b||(h.setAttribute(g,"return;"),b="function"==typeof h[g]),a[c[i]]=b}return a.touchstart&&a.touchend&&a.touchmove}catch(w){return!1}}function c(){return U.touchSupport===!0||U.touchSupport===!1?U.touchSupport:a()}return{createDragger:function(a){return function(e){return U.disabled?!1:"move"!==a||U.allowMove?(Q=v(it),yt=!0,S(a,y(Mt.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(e){return D(Mt.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:a,support:c()}}(),Ot=function(){function a(a){a=v(a),j=M=a[0],F=O=a[1]}function c(a){a=v(a),k=a[0]-j,z=a[1]-F,j=a[0],F=a[1]}function h(){return[k,z]}function g(a){var c=a[0],h=a[1];0>M+c&&(c-=c+M),0>O+h&&(h-=h+O),F+h>st&&(h+=st-(F+h)),j+c>at&&(c+=at-(j+c)),M+=c,j+=c,O+=h,F+=h}function b(a){var c=w();switch(a){case"ne":return[c.x2,c.y];case"nw":return[c.x,c.y];case"se":return[c.x2,c.y2];case"sw":return[c.x,c.y2]}}function w(){if(!U.aspectRatio)return C();var a,c,h,g,b=U.aspectRatio,w=U.minSize[0]/wt,v=U.maxSize[0]/wt,k=U.maxSize[1]/vt,z=j-M,H=F-O,D=Math.abs(z),I=Math.abs(H),B=D/I;return 0===v&&(v=10*at),0===k&&(k=10*st),b>B?(c=F,h=I*b,a=0>z?M-h:h+M,0>a?(a=0,g=Math.abs((a-M)/b),c=0>H?O-g:g+O):a>at&&(a=at,g=Math.abs((a-M)/b),c=0>H?O-g:g+O)):(a=j,g=D/b,c=0>H?O-g:O+g,0>c?(c=0,h=Math.abs((c-O)*b),a=0>z?M-h:h+M):c>st&&(c=st,h=Math.abs(c-O)*b,a=0>z?M-h:h+M)),a>M?(w>a-M?a=M+w:a-M>v&&(a=M+v),c=c>O?O+(a-M)/b:O-(a-M)/b):M>a&&(w>M-a?a=M-w:M-a>v&&(a=M-v),c=c>O?O+(M-a)/b:O-(M-a)/b),0>a?(M-=a,a=0):a>at&&(M-=a-at,a=at),0>c?(O-=c,c=0):c>st&&(O-=c-st,c=st),S(y(M,O,a,c))}function v(p){return p[0]<0&&(p[0]=0),p[1]<0&&(p[1]=0),p[0]>at&&(p[0]=at),p[1]>st&&(p[1]=st),[Math.round(p[0]),Math.round(p[1])]}function y(a,c,h,g){var b=a,w=h,v=c,y=g;return a>h&&(b=h,w=a),c>g&&(v=g,y=c),[b,v,w,y]}function C(){var a,c=j-M,h=F-O;return ft&&Math.abs(c)>ft&&(j=c>0?M+ft:M-ft),pt&&Math.abs(h)>pt&&(F=h>0?O+pt:O-pt),bt/vt&&Math.abs(h)<bt/vt&&(F=h>0?O+bt/vt:O-bt/vt),gt/wt&&Math.abs(c)<gt/wt&&(j=c>0?M+gt/wt:M-gt/wt),0>M&&(j-=M,M-=M),0>O&&(F-=O,O-=O),0>j&&(M-=j,j-=j),0>F&&(O-=F,F-=F),j>at&&(a=j-at,M-=a,j-=a),F>st&&(a=F-st,O-=a,F-=a),M>at&&(a=M-st,F-=a,O-=a),O>st&&(a=O-st,F-=a,O-=a),S(y(M,O,j,F))}function S(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var k,z,M=0,O=0,j=0,F=0;return{flipCoords:y,setPressed:a,setCurrent:c,getOffset:h,moveOffset:g,getCorner:b,getFixed:w}}(),jt=function(){function c(a,c){j.left.css({height:g(c)}),j.right.css({height:g(c)})}function h(){return b(Ot.getFixed())}function b(a){j.top.css({left:g(a.x),width:g(a.w),height:g(a.y)}),j.bottom.css({top:g(a.y2),left:g(a.x),width:g(a.w),height:g(st-a.y2)}),j.right.css({left:g(a.x2),width:g(at-a.x2)}),j.left.css({width:g(a.x)})}function w(){return a("<div />").css({position:"absolute",backgroundColor:U.shadeColor||U.bgColor}).appendTo(O)}function v(){M||(M=!0,O.insertBefore(it),h(),Ft.setBgOpacity(1,0,1),ut.hide(),y(U.shadeColor||U.bgColor,1),Ft.isAwake()?S(U.bgOpacity,1):S(1,1))}function y(a,c){N(z(),a,c)}function C(){M&&(O.remove(),ut.show(),M=!1,Ft.isAwake()?Ft.setBgOpacity(U.bgOpacity,1,1):(Ft.setBgOpacity(1,1,1),Ft.disableHandles()),N(ct,0,1))}function S(a,c){M&&(U.bgFade&&!c?O.animate({opacity:1-a},{queue:!1,duration:U.fadeTime}):O.css({opacity:1-a}))}function k(){U.shade?v():C(),Ft.isAwake()&&S(U.bgOpacity)}function z(){return O.children()}var M=!1,O=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),j={top:w(),left:w().height(st),right:w().height(st),bottom:w()};return{update:h,updateRaw:b,getShades:z,setBgColor:y,enable:v,disable:C,resize:c,refresh:k,opacity:S}}(),Ft=function(){function c(c){var h=a("<div />").css({position:"absolute",opacity:U.borderOpacity}).addClass(b(c));return dt.append(h),h}function h(c,h){var g=a("<div />").mousedown(O(c)).css({cursor:c+"-resize",position:"absolute",zIndex:h}).addClass("ord-"+c);return Mt.support&&g.bind("touchstart.jcrop",Mt.createDragger(c)),lt.append(g),g}function w(a){var c=U.handleSize,g=h(a,W++).css({opacity:U.handleOpacity}).addClass(b("handle"));return c&&g.width(c).height(c),g}function v(a){return h(a,W++).addClass("jcrop-dragbar")}function y(a){var i;for(i=0;i<a.length;i++)X[a[i]]=v(a[i])}function C(a){var h,i;for(i=0;i<a.length;i++){switch(a[i]){case"n":h="hline";break;case"s":h="hline bottom";break;case"e":h="vline right";break;case"w":h="vline"}Y[a[i]]=c(h)}}function S(a){var i;for(i=0;i<a.length;i++)L[a[i]]=w(a[i])}function k(x,a){U.shade||ut.css({top:g(-a),left:g(-x)}),ht.css({top:g(a),left:g(x)})}function z(a,c){ht.width(Math.round(a)).height(Math.round(c))}function M(){var a=Ot.getFixed();Ot.setPressed([a.x,a.y]),Ot.setCurrent([a.x2,a.y2]),j()}function j(a){return E?H(a):void 0}function H(a){var c=Ot.getFixed();z(c.w,c.h),k(c.x,c.y),U.shade&&jt.updateRaw(c),E||I(),a?U.onSelect.call(It,F(c)):U.onChange.call(It,F(c))}function D(a,c,h){(E||c)&&(U.bgFade&&!h?it.animate({opacity:a},{queue:!1,duration:U.fadeTime}):it.css("opacity",a))}function I(){ht.show(),U.shade?jt.opacity(zt):D(zt,!0),E=!0}function P(){R(),ht.hide(),U.shade?jt.opacity(1):D(1),E=!1,U.onRelease.call(It)}function J(){G&&lt.show()}function A(){return G=!0,U.allowResize?(lt.show(),!0):void 0}function R(){G=!1,lt.hide()}function T(a){a?(mt=!0,R()):(mt=!1,A())}function K(){T(!1),M()}var E,W=370,Y={},L={},X={},G=!1;U.dragEdges&&a.isArray(U.createDragbars)&&y(U.createDragbars),a.isArray(U.createHandles)&&S(U.createHandles),U.drawBorders&&a.isArray(U.createBorders)&&C(U.createBorders),a(document).bind("touchstart.jcrop-ios",function(e){a(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var N=B().mousedown(O("move")).css({cursor:"move",position:"absolute",zIndex:360});return Mt.support&&N.bind("touchstart.jcrop",Mt.createDragger("move")),dt.append(N),R(),{updateVisible:j,update:H,release:P,refresh:M,isAwake:function(){return E},setCursor:function(a){N.css("cursor",a)},enableHandles:A,enableOnly:function(){G=!0},showHandles:J,disableHandles:R,animMode:T,setBgOpacity:D,done:K}}(),Ht=function(){function c(c){St.css({zIndex:450}),c?a(document).bind("touchmove.jcrop",v).bind("touchend.jcrop",C):M&&a(document).bind("mousemove.jcrop",g).bind("mouseup.jcrop",b)}function h(){St.css({zIndex:290}),a(document).unbind(".jcrop")}function g(e){return k(y(e)),!1}function b(e){return e.preventDefault(),e.stopPropagation(),yt&&(yt=!1,z(y(e)),Ft.isAwake()&&U.onSelect.call(It,F(Ot.getFixed())),h(),k=function(){},z=function(){}),!1}function w(a,h,g){return yt=!0,k=a,z=h,c(g),!1}function v(e){return k(y(Mt.cfilter(e))),!1}function C(e){return b(Mt.cfilter(e))}function S(t){St.css("cursor",t)}var k=function(){},z=function(){},M=U.trackDocument;return M||St.mousemove(g).mouseup(b).mouseout(b),it.before(St),{activateHandlers:w,setCursor:S}}(),Dt=function(){function c(){U.keySupport&&(w.show(),w.focus())}function h(){w.hide()}function g(e,x,a){U.allowMove&&(Ot.moveOffset([x,a]),Ft.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function b(e){if(e.ctrlKey||e.metaKey)return!0;xt=e.shiftKey?!0:!1;var a=xt?10:1;switch(e.keyCode){case 37:g(e,-a,0);break;case 39:g(e,a,0);break;case 38:g(e,0,-a);break;case 40:g(e,0,a);break;case 27:U.allowSelect&&Ft.release();break;case 9:return!0}return!1}var w=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),v=a("<div />").css({position:"absolute",overflow:"hidden"}).append(w);return U.keySupport&&(w.keydown(b).blur(h),_||!U.fixedSupport?(w.css({position:"absolute",left:"-20px"}),v.append(w).insertBefore(it)):w.insertBefore(it)),{watchKeys:c}}();Mt.support&&St.bind("touchstart.jcrop",Mt.newSelection),lt.hide(),V(!0);var It={setImage:G,animateTo:J,setSelect:A,setOptions:E,tellSelect:T,tellScaled:K,setClass:P,disable:W,enable:Y,cancel:L,release:Ft.release,destroy:X,focus:Dt.watchKeys,getBounds:function(){return[at*wt,st*vt]},getWidgetSize:function(){return[at,st]},getScaleFactor:function(){return[wt,vt]},getOptions:function(){return U},ui:{holder:ct,selection:ht}};return $&&ct.bind("selectstart",function(){return!1}),tt.data("Jcrop",It),It},a.fn.Jcrop=function(c,h){var g;return this.each(function(){if(a(this).data("Jcrop")){if("api"===c)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(c)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),g=a.Jcrop(this,c),a.isFunction(h)&&h.call(g)}):(a(this).css({display:"block",visibility:"hidden"}),g=a.Jcrop(this,c),a.isFunction(h)&&h.call(g))}),this},a.Jcrop.Loader=function(c,h,g){function b(){v.complete?(w.unbind(".jcloader"),a.isFunction(h)&&h.call(v)):window.setTimeout(b,50)}var w=a(c),v=w[0];w.bind("load.jcloader",b).bind("error.jcloader",function(){w.unbind(".jcloader"),a.isFunction(g)&&g.call(v)}),v.complete&&a.isFunction(h)&&(w.unbind(".jcloader"),h.call(v))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);