define("static/pages/p-member/pollZfb",["static/lib/handlebars/handlebars-amd"],function(a){var c=function(a){a=a||{},this.refresh=a.refresh,this.payHost="http://pay.qiaobutang.com",this.chargeId=window.localStorage.getItem("chargeId"),this.price=window.localStorage.getItem("chargePrice"),this.orderNo=window.localStorage.getItem("chargeOrderNo");var c=window.location.search.split("buyer_email=").length>1;c||this.clearPolling(),this.chargeId&&c&&this.init()};return c.prototype={init:function(){var a=this;this.count=0,this.timer=setInterval(function(){a.polling(a.chargeId)},2e3)},renderPayZfbPopup:function(c){var h=a.compile($("[data-template-name=pay_zfb]").html()),g=$.extend({},OverlayPopup,{classNames:["popup","db-popup","db-popup__wx"]});g.setContent(h(c)),g.show()},polling:function(a){var c=this;c.count++,c.count<60?$.ajax({type:"GET",url:c.payHost+"/pay/poll/"+a,xhrFields:{withCredentials:!0}}).done(function(a){200!==a.resultCode||a.isPaid?(c.clearPolling(),c.refresh&&window.location.reload()):(c.renderPayZfbPopup({price:c.price}),c.clearPolling())}):c.clearPolling()},clearPolling:function(){var a=this;clearInterval(this.timer),window.localStorage.removeItem("chargeId"),window.localStorage.removeItem("chargePrice"),window.localStorage.removeItem("chargeOrderNo"),a.orderNo&&$.ajax({type:"POST",url:a.payHost+"/pay/order/cancel/"+a.orderNo,xhrFields:{withCredentials:!0}}).done(function(){})}},c});