var Resume=$j.extend({},Base,{init:function(){require(["static/pages/p-member/pollZfb"],function(a){new a}),$j.extend(this,this.getLayout()),this.bind()},getLayoutName:function(){return $j("#layout_name").val()},getLayout:function(){for(var a=this.getLayoutName(),i=0,c=[this.RowLayout()];i<c.length;i+=1)if(c[i].name()===a)return c[i];return $j.Noty({text:"操作失败：无法识别布局",type:"error"}),this.BaseLayout()},getResumeId:function(){return $j("#resume_id").val()},getResumeTitleElement:function(){return $j("span.resume-title")},getResumeTitle:function(){return this.getResumeTitleElement().text()},API:function(){return $j.extend({},{bind:function(){},save:function(){},addListener:function(){},removeListener:function(){}})},BaseLayout:function(){return $j.extend({},this.API(),Helper,{selector:function(){return".resume"},name:function(){return""},units:{length:"mm",weight:"pt",font:"pt",converters:{mm2pt:function(a){return 72*a/25.4},pt2mm:function(a){return 25.4*a/72}}},consts:{loginFormSelector:".login_form",editPhotoId:"edit_photo",photoAlignId:"photo_align",fontSizeTip:{5:"八号",5.5:"七号",6.5:"小六",7.5:"六号",9:"小五",10.5:"五号",12:"小四",14:"四号",15:"小三",16:"三号",18:"小二",22:"二号",24:"小一",26:"一号",36:"小初",42:"初号"}},getFontSizeTip:function(a){return this.consts.fontSizeTip[a.toString()]},listeners:{},getListenerAPI:function(){var a=this;return{add:function(c,h){a.listeners[c]=h},remove:function(c){delete a.listeners[c]},onAfterSaved:"onAfterSaved",onItemEditBegin:"onItemEditBegin",onPhotoEdit:"onPhotoEdit",notify:function(c,h){a.simulateFakeThread(function(){$j.each(a.listeners,function(g,v){var w=v[c];a.notNullable(w)&&a.applyFunction(a,w,h)})})},notifyAfterSaved:function(){this.notify(this.onAfterSaved)},notifyItemEditBegin:function(a,c,h){this.notify(this.onItemEditBegin,[a,c,h])},notifyPhotoEdit:function(){this.notify(this.onPhotoEdit)}}},addListener:function(a,c){this.getListenerAPI().add(a,c)},removeListener:function(a){this.getListenerAPI().remove(a)},bind:function(){var a=this,c="unseen";return a.stickUpToolbar(),a.bindHotkeys(),a.bindCommon().bindLayout(),a.fillResumeSetting(JSON.parse($j("#resume_setting").val())),a.isResumeDirty()?a.isNeedLogin()||a.save(function(){},!0):a.isNeedLogin()&&a.dirtyResume(),a.getResumeContainer().removeClass(c),$j(".resume_loading").remove(),$j(".help-center").show(),this},bindCommon:function(){var a=this.getResumeHead(),c=a.find(".resume-edit-title"),h=this;return c.off("click").click(function(){return h.showChangeTitlePopup(),!1}),$j(window).on("beforeunload",function(){return h.isResumeDirty()?h.dirtyResumeMessage+"，确定要离开么 ?":void 0}),$j(".global-login-item a").off("click").on("click",function(){return h.needLogin(),!1}),$j(".global-register-item a").on("click",function(){return h.needLogin(void 0,!0),!1}),$(document).on("keydown keypress",function(e){8!==e.keyCode||/input|textarea/i.test(e.target.nodeName)||e.preventDefault()}),$(".main_content").click(function(e){"A"!==e.target.nodeName&&h.unSelectAllCells()}),$(".main_content, .resume").click(function(e){e.stopPropagation()}),this},bindToolbar:function(){return this},bindLayout:function(){return this},stickUpToolbar:function(){{var a=this.getResumeToolbar(),c=a.next().closest("div"),h=a.prev().closest("div"),g=a.offset().top,v=a.outerHeight(),w=parseInt(c.css("marginTop"),10);parseInt(h.css("marginBottom"),10)}$j(window).scroll(function(){var h=$j(this).scrollTop();h>=g?(a.addClass("isStuck"),c.css({"padding-top":v+w+w})):(a.removeClass("isStuck"),c.css({"padding-top":w}))}).scroll()},getResumeHeadDom:function(){return $j(".resume_head")},getResumeHead:function(){return this.isNullable(this.cachedResumeHead)&&(this.cachedResumeHead=this.getResumeHeadDom()),this.cachedResumeHead},getPhotosBoxDom:function(a){return this.isNullable(a)&&(a=this.getResumeToolbar()),a.find(".photos_box")},getPhotosBox:function(a){return this.isNullable(this.cachedPhotosBox)&&(this.cachedPhotosBox=this.getPhotosBoxDom(a)),this.cachedPhotosBox},getPhotoId:function(){return""},updatePhotoImage:function(){},photosBoxAPI:{},getSaveIndicator:function(a){return this.isNullable(a)&&(a=this.getResumeToolbar()),a.find("#saving")},isCometEnabled:function(){return this.notNullable(window.liftComet)},getResumeAsterisk:function(){return $j(".resume_head .asterisk")},getResumeAsteriskRemovedClass:function(){return"removed"},pageTitle:PageTitle.get(),dirtyResume:function(){this.getResumeAsterisk().removeClass(this.getResumeAsteriskRemovedClass()),PageTitle.set("*"+this.pageTitle)},cleanResume:function(){this.getResumeAsterisk().addClass(this.getResumeAsteriskRemovedClass()),PageTitle.set(this.pageTitle)},isResumeDirty:function(){return!this.getResumeAsterisk().hasClass(this.getResumeAsteriskRemovedClass())},dirtyResumeMessage:"简历当前有改动尚未保存",getResumeData:function(){return{}},getResumeSetting:function(){var a=this;return $j.extend({auto_save:a.getAutoSaveEnabled()},a.getLayoutSetting())},getLayoutSetting:function(){return{}},fillResumeSetting:function(a){this.fillLayoutSetting(a)},fillLayoutSetting:function(){},save:function(a,c,h){var g=this,v=g.getResumeToolbar(),w=g.getSaveButton(v),b=function(){return JSON.stringify([g.getResumeId(),g.getResumeTitle(),g.getResumeData(),g.getResumeSetting()])},C=function(a){w.parent().removeClass("saving").addClass(a?"saving":"")},S=function(){w.data("disableSave",!0),C(!0)},y=function(){w.data("disableSave",!1),C(!1)},j="保存简历",R=function(){$j.Noty({text:j+"失败，请重试",type:"error"})},P=function(c,h){c?(g.cleanResume(),g.Undo.updateSavepoint(),$j.Noty({text:j+"成功",type:"success"}),g.notNullable(a)&&a(),g.getListenerAPI().notifyAfterSaved()):$j.Noty({text:j+"失败："+h,type:"error"})},k=function(){S(),$j.ajax({type:"POST",dataType:"json",url:"/resume/save",data:{resume:b()},success:function(a,c,v){var w=$(".sider-bar .sider_job");if(g.isNullable(a))R(v,"success-non-data");else{if(a.offline)return $j("input#need_login").val("true"),void g.needLogin();P(a.saved,a.text)}ResumeRecomJob.popType=a.showPopInfo.popType,ResumeRecomJob.jobInfo=a.showPopInfo.content,"noPop"===a.showPopInfo.popType||a.point<60?w.hide():("seekJob"===a.showPopInfo.popType?(w.children().removeClass("active"),w.find(".seekjob").addClass("active")):"job"===a.showPopInfo.popType&&(w.children().removeClass("active"),w.find(".job").addClass("active")),w.show(),w[0].offsetWidth,h!==!0&&ResumeRecomJob.recomJobPopup(1)),g.updateResumePoint(a.point)},error:R,complete:function(){y()}})};w.data("disableSave")!==!0&&g.needLogin(function(){g.isDefaultTitle(g.getResumeTitle())&&c!==!0?g.showChangeTitlePopup(k).setInvalidTitleError().showError():k()})},updateResumePoint:function(a){var c=$(".resume-point"),h=$(".mask",c);-1===a?c.fadeOut():(c.show(),c[0].offsetWidth,h.width(100-a+"%"))},isNeedLogin:function(){return"true"===$j("#need_login").val()},needLogin:function(a,c){var h=this,g=function(a){return $j.ajax({type:"POST",dataType:"json",url:"/resume/save_temporarily",data:{resume:JSON.stringify([h.getResumeId(),h.getResumeTitle(),h.getResumeData(),h.getResumeSetting()])}}).done(function(c){h.sendTrackEvent("save","needLogin"),h.cleanResume(),a(c.redirect)}).fail(function(){$j.Noty({text:"自动保存失败，请重试",type:"error"})})};h.isNeedLogin()?g(function(a){AccountIframe.disableRefresh(),AccountIframe.show(function(){a?window.location.href=a:window.location.reload()},c)}):"function"==typeof a&&a()},prepareRuler:function(a,c,h,g){var v=g?$j("body"):this.getResumeContainer(),w=v.find("#"+a);return w.length>0?(w.addClass(c),h&&w.addClass("dashed")):(w=$j('<div class="ruler"></div>').addClass(c).attr("id",a),h&&w.addClass("dashed"),v.append(w)),w},getChangeTitleOverlayPopup:function(){var a=this;return this.cachedChangeTitleOverlayPopup||(this.cachedChangeTitleOverlayPopup=$j.extend({},OverlayPopup,{showForm:function(c,h,g,v){var w=this,b=$j('<table border="0" cellspacing="0" cellpadding="0"></table>');this.shown||($j.each(h,function(a,c){var h=$j("<label></label>");c.required&&h.append('<span class="required_mark" title="必填项">*</span>'),h.append(c.label),b.append($j("<tr></tr>").append($j("<th></th>").html(h)).append($j('<td class="field"></td>').html($j('<input type="text" class="text" />').attr({id:a,name:a,value:c.value}))))}),b.append($j("<tr/>").append($j("<th/>")).append($j('<td class="error" />').append($j('<div style="color: red;padding-top: 5px;"/>')))),b.append($j("<tr/>").append($j('<td class="form_tip" colspan="2" style="text-indent:50px; padding-top:10px;"/>').append($j(a.getDefaultTitleTip())))),b.append($j("<tr></tr>").append("<th></th>").append($j('<td class="actions"></td>').append(w.createButton(g).off("click").click(function(){var c={};$j.each(h,function(h,s){var g=$j.trim(b.find("#"+h).val());s.required&&""===g?w.setError(s.label+"不能为空"):a.isDefaultTitle(g)&&w.setInvalidTitleError(),c[h]=g}),w.getError()?w.showError():v(c)})).append(w.createCancelLink()))),this.setContent($j('<div class="title"></div>').html(c).add($j('<div class="table_form form"></div>').html(b))),this.show(),b.find(":input:first").focus())},errors:[],shown:!1,setError:function(a){return this.errors.push(a),this},setInvalidTitleError:function(){return this.setError("请更新你的简历标题")},getError:function(){return this.errors[0]},resetError:function(){this.errors=[]},showError:function(){var a=this.getContentElement().find("td.error div");a.text(this.getError()),this.resetError()},afterShow:function(){this.shown=!0},afterHide:function(){this.shown=!1}}))},showChangeTitlePopup:function(a){var c=this,h=c.getResumeTitle(),g=this.getChangeTitleOverlayPopup();return g.showForm("修改简历标题",{title:{label:"简历标题",required:!0,value:h}},"修改",function(v){v.title!==h&&c.updateResume(function(){c.getResumeTitleElement().text(v.title),a&&a()},function(){c.getResumeTitleElement().text(h)}),g.hide()}),g},showSaveasTitlePopup:function(a){var c=this,h=c.getResumeTitle(),g=this.getChangeTitleOverlayPopup();return g.showForm("新创建简历的标题",{title:{label:"简历标题",required:!0,value:h}},"另存为",function(c){a(c.title),g.hide()}),g},getDefaultTitleInfo:function(){var a=$j("#recommend_resume_title").val();return JSON.parse(a)},getDefaultTitleTip:function(){return this.getDefaultTitleInfo().htmlTips},getDefaultTitle:function(){return this.getDefaultTitleInfo().value},isDefaultTitle:function(a){return this.getDefaultTitle()===a},getDropdowns:function(){var a=this.dropdowns;return this.isNullable(a)&&(a={}),a},setDropdowns:function(a){this.isNullable(a)&&(a={}),this.dropdowns=a},saveDropdown:function(a,c){var h=this.getDropdowns();h[a]=c,this.setDropdowns(h)},getDropdown:function(a){var c=this.getDropdowns();return c[a]},Undo:function(a){return $j.extend({},BaseUndo,{isSaved:function(){return!a.isNeedLogin()&&this.getLastUndoCmdId()===this.history.savepoint},changed:function(){this.isSaved()?a.cleanResume():a.dirtyResume(),$("#undo, #redo").removeClass("disabled"),0===this.history.undo.length&&$("#undo").addClass("disabled"),0===this.history.redo.length&&$("#redo").addClass("disabled")}})}(this),Hotkeys:$j.extend({},Hotkeys,{getName:function(){return"resumeHotkeys"}}),bindHotkeys:function(){return this.Hotkeys.enable(),this},addHotkey:function(a,c,h,g,v){var w,b=[],C=this,$=this.Hotkeys,S=function(){C.blurAllTextarea(),v()},y=a.attr("title");h&&g?(b.push("Ctrl","Shift"),w=$.getHotkeyWithCtrlShift(c,S)):h&&(b.push("Ctrl"),w=$.getHotkeyWithCtrl(c,S)),b.push(String.fromCharCode(c)),a.attr("title",y?y+" "+b.join(" + "):b.join(" + ")),a.tooltip({placement:"bottom",container:C.getResumeToolbar()}),$.addHotkey(w)},sendTrackEvent:function(a,c,h){var g,v=this;void 0===h&&(g=this.getResumeId(),h=[a,c,g].join("-")),c=a+"-"+c,this.simulateFakeThread(function(){v.trackEvent(a,c,h)})}})},RowLayout:function(){return $j.extend(!0,{},this.BaseLayout(),{selector:function(){return".row_layout"},name:function(){return"row"},getResumeData:function(){var a=this,c=a.getInnerResume(),h=a.getPhoto(c),g=function(a){var c={};return $j.each(a,function(a,h){c[a.match(/(^[a-z])|([A-Z])/g).join("").toLowerCase()]=h}),c};return{margin:a.getResumeMargin(c),photo:{id:a.getPhotoId(h),f:g(a.getPhotoFormats(h))},sections:$j.map(c.find(".section"),function(c){var h=$j(c);return{k:a.getKeyField(h).val(),r:$j.map(h.find(".row"),function(c){var h=$j(c);return{a:a.isAffectedByPhoto(h),s:a.getSpaceOfRow(h),c:$j.map(h.find(".cell"),function(c){var h=$j(c);return{k:a.getKeyField(h).val(),t:a.getCellTextDirectly(h).text(),f:g(a.getCellFormats(h))}})}})}})}},getLayoutSetting:function(){return{page_mark:this.getPageMarkExpanded(),page_margin:this.getPageMarginSliderVisible(),grid:this.getGridVisible(),library:this.getLibraryVisible(),auto_save:this.getAutoSaveEnabled()}},fillLayoutSetting:function(a){var c=this.toolbarHelper;return this.BaseLayout().fillLayoutSetting.call(this,a),this.isNeedLogin()?this.getAutoSaveComponent().hide():c.setCheckBoxComponentState(this.getAutoSaveComponent(),"true"===a.auto_save),this.updateAutoSaveEnabled(),this.getPageMark().data("autoCheckEndPage",!0),("true"===a.page_mark||this.isEndOfPage())&&this.togglePageMarkWarn(!0),c.setCheckBoxComponentState($j("#grid"),"true"===a.grid),this.updateGridVisible(),c.setCheckBoxComponentState($j("#page-margin"),"true"===a.page_margin),this.updatePageMarginSliderVisible(),c.setCheckBoxComponentState($j("#library"),"true"===a.library),this.updateLibraryVisible(),this},getResumeToolbarDom:function(){return $j(".new-toolbar")},getResumeToolbar:function(){return this.isNullable(this.cachedResumeToolbar)&&(this.cachedResumeToolbar=this.getResumeToolbarDom()),this.cachedResumeToolbar},getSaveButton:function(a){return this.isNullable(a)&&(a=this.getResumeToolbar()),a.find("#save")},getPhotoSettingComponent:function(a){return this.isNullable(a)&&(a=this.getResumeToolbar()),a.find("#photo-setting")},getAutoSaveComponent:function(){return $j("#auto-save")},getAutoSaveEnabled:function(){return!this.isNeedLogin()&&this.toolbarHelper.getCheckBoxComponentState(this.getAutoSaveComponent())},autoSaveDurationInMinute:5,updateAutoSaveEnabled:function(){var a=this,c=a.getAutoSaveEnabled();window.clearInterval(a.autoSaveInterval),c&&(a.autoSaveInterval=window.setInterval(function(){a.isResumeDirty()&&a.save(null,null,!0)},60*a.autoSaveDurationInMinute*1e3))},bindLayout:function(){return this.bindResumeSpace(),this.bindContent(),this.bindToolbar(),this.updateContentEditable(),this.updateSortElements(),function(a){try{var c;$(".cell").each(function(){return""!==$.trim($(this).text())?($(this).click(),c=$(this),!1):void 0}),c&&(c.addClass("ui-selecting"),a.getResume().data("ui-selectable")._mouseStop(null))}catch(e){}}(this),this},bindContent:function(){this.bindMargin().bindSections().bindPhoto()},bindToolbar:function(){var a=this.getResumeToolbar();$j(".dropdown__list [href^=#]",a).click(function(e){e.preventDefault()}),$j(".new-toolbar__section",a).each(function(){Helper.makeUnselectable($j(this))}),require(["static/components/tab/index"],function(a){a.init()}),this.bindExportComponent(),this.bindSaveComponent(),this.bindSaveasComponent(),this.bindOtherComponent(),this.bindPhotoSettingComponent(),this.bindFontComponents(),this.bindCellComponents(),this.bindUndoRedoComponent()},bindSidebar:function(){$(".sider-toolbar").draggable({handle:".sider-toolbar__header"}),Helper.makeUnselectable($(".sider-toolbar *"))},bindContextMenu:function(){var a=this,c=$("#contextMenu"),h=c.find(".secMenu"),g=c.find(".addItem .secMenu"),v=c.find(".addAlign .secMenu"),w=c.find("li"),b=c.find(".choseCell"),C=$("#contextMenu a");$(".main_content").on("contextmenu",function(e){var S=c.height(),y=c.width();e.clientY+S<$(window).height()?c.css({top:e.pageY,left:e.pageX}).show():c.css({top:e.pageY-S,left:e.pageX}).show(),e.clientX+y>$(window).width()&&c.css("left",e.pageX-y);var j=c.offset().top-$(window).scrollTop(),R=c.offset().left-$(window).scrollLeft(),P=v.outerHeight(),k=v.outerWidth(),T=g.find("a").length,I=v.find("a").length;j+P>$(window).height()?(g.css("top",-36*T+"px"),v.css("top",-36*I+1+"px")):(g.css("top","-34px"),v.css("top","-33px")),R+2*k>$(window).width()?h.css("left","-182px"):h.css("left","150px"),C.off("click mouseenter mouseleave");var N=a.getSelectedCells(),E=a.getSelectedSections();return 0===N.length?(w.addClass("fnUnActive"),b.show().text("请选择操作内容"),w.hover(function(){b.show().text("请选择操作内容")})):(w.removeClass("fnUnActive"),1!==E.length?(w.eq(0).addClass("fnUnActive").hover(function(){b.show().text("请不要选择多行")}),w.eq(1).hover(function(){b.hide()})):(w.eq(0).removeClass("fnUnActive"),w.hover(function(){b.hide()}),a.bindContextMenuAddItem()),a.bindContextMenuAddAlign(),b.hide()),w.hover(function(){$(this).find(".secMenu").show()},function(){$(this).find(".secMenu").hide()}),!1}),$("body *").click(function(){c.hide()})},bindContextMenuAddItem:function(){var a=$("#add-crs"),c=a.find(".dropdown-menu li"),h=$(".btn-component-group.dropdown-tool");$("#contextMenu a:lt(4)").click(function(){c.filter("."+this.className).trigger("click")}).hover(function(){c.filter("."+this.className).trigger("mouseenter"),h.removeClass("open")},function(){c.filter("."+this.className).trigger("mouseleave"),h.removeClass("open")})},bindContextMenuAddAlign:function(){var a=$("#cell-align"),c=a.find(".horizontal-align"),h=a.find(".vertical-align"),g=a.find(".horizontal-align .btn-component"),v=a.find(".vertical-align .btn-component");$("#contextMenu a:gt(3):lt(7)").click(function(){var a=$(this).data("style");g.filter("[data-style="+a+"]").trigger("click"),h.hide(),c.show()}),$("#contextMenu a:gt(7)").click(function(){var a=$(this).data("style");v.filter("[data-style="+a+"]").trigger("click"),c.hide(),h.show()})},toolbarComponents:[],getFormatValue:function(a){var c,h=$j(),g=this.selectedObj;return a.cell?(h=h.add(g.cell),a.photo&&(h=h.add(g.photo))):a.textContainer?(h=h.add(g.textContainer),a.photo&&(h=h.add(g.img))):a.text&&(h=h.add(g.text)),c=$j.unique(h.map(function(){return a.filter($j(this))})),0===c.length?"default":c.length>1?"mixed":1===c.length?c[0]:void 0},toolbarHelper:{setCheckBoxComponentState:function(a,c){a.prop("checked",!!c)},getCheckBoxComponentState:function(a){return a.is(":checked")},flashTip:function(a,c,h){a.tooltip({trigger:"manual"}),a.tooltip("setTitle",c),a.tooltip("show"),a.tipTimer&&window.clearTimeout(a.tipTimer),a.tipTimer=window.setTimeout(function(){a.tooltip("hide"),a.tipTimer=null},h)},getBorderStyle:function(a){var c="none";return $j.each(["Top","Right","Bottom","Left"],function(i,h){var g=a.css("border"+h+"Style");return"none"!==g?(c=g,!1):void 0}),c},willChangeBorder:function(a){for(var i=0;i<a.length;i++)if("none"!==a[i])return!0;return!1},radioify:function(a,c){var h=function(){var c={};return a.each(function(){c[$(this).data("value")]=$(this)}),c}(),g=function(c){return c===v()?!1:(a.removeClass("active"),void(h[c]&&h[c].addClass("active")))},v=function(){return a.filter(".active").data("value")};return a.click(function(){g($(this).data("value"))!==!1&&c($(this).data("value"))}),{check:g}},numberify:function(a,c){var h=$(".editor-number__view",a);return $.each({".editor-number__plus":function(a){return Helper.roundDecimal(a+c,1)},".editor-number__minus":function(a){return Helper.roundDecimal(a-c,1)}},function(c,g){var v,w,b=function(){h.val(g(+h.val()))},C=function(){v=setTimeout(function(){b(),C()},100)};$(c,a).on("mousedown",function(){w=!0,b(),v=setTimeout(function(){C()},1e3)}).on("mouseup mouseleave",function(){w===!0&&(w=!1,clearTimeout(v),h.trigger("change"))})}),{$view:h,set:function(a){h.val(a)}}}},bindOtherComponent:function(){return $.each([{selector:"#page-margin",handler:$.proxy(this.updatePageMarginSliderVisible,this)},{selector:"#library",handler:$.proxy(this.updateLibraryVisible,this)},{selector:"#auto-save",handler:$.proxy(this.updateAutoSaveEnabled,this)},{selector:"#grid",handler:$.proxy(this.updateGridVisible,this)}],function(a,c){$(c.selector).change(c.handler)}),this},bindPhotoSettingComponent:function(){var a=$j("#photo-setting"),c=this.getPhoto(),h=this.getPhotoAlign(c),g=this,v=function(a){c.removeClass("left").removeClass("right").addClass(a).trigger(g.photoEvents.alignchange)};return $j.jobPhoto({align:!0,alingChange:function(a){var h=g.getPhotoAlign(c);return a===h?!1:void g.updateResume(function(){v(a),$j.jobPhoto().selectPhotoAlign(a)},function(){v(h),$j.jobPhoto().selectPhotoAlign(h)})},beforeShow:function(){$j("html, body").animate({scrollTop:150},1e3),a.addClass("active"),g.getListenerAPI().notifyPhotoEdit()},beforeHide:function(){a.removeClass("active")},reloadSuccess:function(){this.selectPhotoById(g.getPhotoId()),this.selectPhotoAlign(h)},afterSelectedPhoto:function(a,c){g.updatePhotoImage(a,c)}}),a.click(function(){$j.jobPhoto().toggle()}),this},bindExportComponent:function(){var a,c=this,h=$("#export"),g=Handlebars.compile($("[data-template-name=export]").html()),v=$.extend({},OverlayPopup,{classNames:["popup","export-popup"],beforeShow:function(){var a=this,c=this.getElement(),h=$(".export-component",c);h.click(function(){$(this).toggleClass("active")}),$(".export-trigger",c).click(function(){var c=h.filter(".active").map(function(){var a=$j(this);return{type:a.data("type"),name:a.data("name")}});c.length>0&&(a.hide(),w(c))})}}),w=function(h){if(0!==h.length){var g=1===h.length?{type:h[0].type,name:h[0].name}:{type:"zip",name:"zip"},v=$.map(h,function(exports){return $('<input type="hidden" name="format" value="'+exports.type+'"/>')});$('<form method="get" action="/resume/export" target="export-target" id="export-form" />').append('<input type="hidden" name="type" value="'+g.type+'"/>').append('<input type="hidden" name="id" value="'+c.getResumeId()+'"/>').append(v).appendTo("body").submit().remove(),c.sendTrackEvent("export",a)}};h.click(function(){c.needLogin(function(){var h=function(){LiftAjaxWrapper.call("getExportDataForAjax",null,function(h){var w=h;w.isMember||w.exportable?(v.setContent(g(w)),v.show(),a=w.isMember?"member":"credit"):(c.sendTrackEvent("export","deny"),c.needMemberPopup())})};c.isResumeDirty()?$.extend({},OverlayPopup).showConfirm("下载简历",c.dirtyResumeMessage+"，确定要下载简历么 ?",{"保存后下载":function(){var a=$.proxy(this.hide,this);c.save(function(){a(),h()})},"直接下载":function(){this.hide(),h()}}):h()})})},needMemberPopup:function(){var a=Handlebars.compile($("[data-template-name=unvip]").html()),c=$.extend({},OverlayPopup,{classNames:["popup","export-popup","export-popup__unvip"],afterShow:function(){$(".qbt-pay__zfb").click(function(){c.hide();var a=$(this);require(["static/pages/p-member/pay_popup"],function(c){a.hasClass("hasClicked")||(a.addClass("hasClicked"),new c({type:"zfb",commodityId:"57849ad6f3a78cd40e57908f",title:"乔布简历_简历模板会员"}))})}),$(".qbt-pay__wx").click(function(){c.hide();var a=$(this);require(["static/pages/p-member/pay_popup"],function(c){a.hasClass("hasClicked")||(a.addClass("hasClicked"),new c({type:"wx",commodityId:"57849ad6f3a78cd40e57908f",title:"乔布简历_简历模板会员"}))})})}});c.setContent(a()),c.show()},bindSaveComponent:function(){var a=this.getSaveButton(),c=this;a.off("click").click(function(){c.sendTrackEvent("save","button"),c.save()}),this.addHotkey(a,83,!0,!1,function(){c.sendTrackEvent("save","hotkey"),c.save()})},bindSaveasComponent:function(){var a=this,c=$("#saveas"),h=function(c){$.ajax({type:"POST",dataType:"json",url:"/resume/save_as",data:{resume:JSON.stringify([a.getResumeId(),c,a.getResumeData(),a.getResumeSetting()])},success:function(c){return c.offline?($j("input#need_login").val("true"),void a.needLogin()):void(c.saved?($(window).off("beforeunload"),window.location.href=c.url):$j.Noty({text:"另存为失败",type:"error"}))}})};c.click(function(){a.needLogin(function(){a.showSaveasTitlePopup(h)}),$(this).parents("[data-component=dropdown]").data("component.dropdown").closeMenu()})},bindFontComponents:function(){this.bindFontFamily(),this.bindFontSize(),this.bindFontColor(),this.bindFontBackground(),this.bindFontWeight(),this.bindFontStyle(),this.bindTextDecoration()},bindFontFamily:function(){var a=$j("#font-family"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){return a.attr("class").split(" ")[0]}}),g=a.data("defaultValue");a.data("component.select").bugFixRefresh("default"===h?g:"mixed"===h?"mixed":h)}};return c.toolbarComponents.push(h),a.on("change",function(){var a=$(this).val(),h=function(a){a.trigger(c.cellEvents.fontsizechange),c.cellsHeightChanged(a)};c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).attr("class")})},function(g){c.getCellTextDirectly(g).attr("class",a),h(g)},function(a,g){c.getCellTextDirectly(a).each(function(i,a){$j(a).attr("class",g[i])}),h(a)}])}),this},bindFontSize:function(){var a=$j("#font-size"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){return window.parseFloat(a.css("fontSize-raw"))}}),g=a.data("defaultValue");a.data("component.select").bugFixRefresh("default"===h?g:"mixed"===h?"mixed":h)}};return c.toolbarComponents.push(h),a.on("change",function(){var a=$j(this),h=a.val()+c.units.font,g=function(a){a.trigger(c.cellEvents.fontsizechange),c.cellsHeightChanged(a)};c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).css("fontSize-raw")})},function(a){c.getCellTextDirectly(a).css("fontSize",h),g(a)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("fontSize",h[i])}),g(a)}])}),a.find(".dropdown__list .option").tooltip({placement:"left",title:function(){return c.getFontSizeTip(window.parseFloat($j(this).data("value")))},container:".new-toolbar"}),this},bindFontColor:function(){var a=$j("#font-color"),c=this,h={component:a,defaultValue:"default",refreshComponent:function(){var a=this.component,h=(this.defaultValue,c.getFormatValue({text:!0,filter:function(a){return a.css("color").replace(/\s/g,"")}}));a.data("component.select").bugFixRefresh("default"===h||"mixed"===h?"mixed":h)}};c.toolbarComponents.push(h),a.on("change",function(){var a=$(this).val();c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).prop("style").color})},function(h){c.getCellTextDirectly(h).css("color",a)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("color",h[i])})}])})},bindFontBackground:function(){var a=$j("#font-background"),c=this,h=(this.toolbarHelper,{component:a,defaultValue:"default",refreshComponent:function(){var a=this.component,h=(this.defaultValue,c.getFormatValue({text:!0,filter:function(a){var h=a.css("backgroundColor").replace(/\s/g,""),g=c.getColorValueOfCss(h);return g?h:"transparent"}}));a.data("component.select").bugFixRefresh("default"===h||"mixed"===h?"mixed":h)}});c.toolbarComponents.push(h),a.on("change",function(){var a=$(this).val();c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).prop("style").backgroundColor})},function(h){c.getCellTextDirectly(h).css("backgroundColor",a)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("backgroundColor",h[i])})}])})},bindFontWeight:function(){var a=$j("#font-weight"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){return a.css("fontWeight-raw")}});"bold"===h?a.addClass("active"):a.removeClass("active")}};c.toolbarComponents.push(h),a.off("click").click(function(){var a;a=$j(this).hasClass("active")?"normal":"bold",c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).prop("style").fontWeight})},function(h){c.getCellTextDirectly(h).css("fontWeight",a),c.cellsHeightChanged(h)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("fontWeight",h[i])}),c.cellsHeightChanged(a)}])}),this.addHotkey(a,66,!0,!1,function(){a.click()})},bindFontStyle:function(){var a=$j("#font-style"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){return a.css("fontStyle")}});"italic"===h?a.addClass("active"):a.removeClass("active")}};c.toolbarComponents.push(h),a.off("click").click(function(){var a;a=$j(this).hasClass("active")?"normal":"italic",c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).prop("style").fontStyle})},function(h){c.getCellTextDirectly(h).css("fontStyle",a)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("fontStyle",h[i])})}])}),this.addHotkey(a,73,!0,!1,function(){a.click()})},bindTextDecoration:function(){var a=$j("#font-text-decoration"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){return!!~a.css("textDecoration").indexOf("underline")}});h===!0?a.addClass("active"):a.removeClass("active")}};c.toolbarComponents.push(h),a.off("click").click(function(){var a=$j(this).hasClass("active")?"none":"underline";c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return-1!==$(this).css("textDecoration").indexOf("underline")?"underline":""})},function(h){c.getCellTextDirectly(h).css("textDecoration",a)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("textDecoration",h[i])})}])}),this.addHotkey(a,85,!0,!1,function(){a.click()})},bindCellComponents:function(){this.bindAlign(),this.bindBorder(),this.bindMarginResize(),this.bindCellBackground(),this.bindCellWidth(),this.bindLineHeight(),this.bindCRSBinding(),this.bindCRSAdd(),this.bindCRSRm()},bindAlign:function(){var a=this,c=function(c,h){return function(g){a.updateSelected([function(a){return a.map(function(){return $j(this).prop("style")[c]})},function(a){a.css(c,g),h&&h(a)},function(a,g){a.each(function(i,a){$j(a).css(c,g[i])}),h&&h(a)}])}},h=this.toolbarHelper.radioify($("#horizontal-align > *"),c("textAlign")),g=this.toolbarHelper.radioify($("#vertical-align > *"),c("verticalAlign",function(c){c.trigger(a.cellEvents.startpointychange)})),v=function(c,h){return function(){var g=a.getFormatValue({cell:!0,filter:function(a){return a.css(h)}});c.check("default"===g||"mixed"===g?"mixed":g)}},w={refreshComponent:v(h,"text-align")},b={refreshComponent:v(g,"vertical-align")};a.toolbarComponents.push(w,b);var C=function(c,h){var g=$("[data-value="+h+"]",$("#horizontal-align, #vertical-align"));a.addHotkey(g,c,!0,!0,function(){g.click()})};C(76,"left"),C(69,"center"),C(82,"right"),C(74,"justify"),C(80,"top"),C(77,"middle"),C(66,"bottom")},bindBorder:function(){this.bindBorderShow(),this.bindBorderColor(),this.bindBorderStyle(),this.bindBorderWidth()},bindBorderShow:function(){var a=this;$.each({"#border-top":"top","#border-bottom":"bottom","#border-left":"left","#border-right":"right"},function(c,h){a.toolbarComponents.push({refreshComponent:function(){var g=$(c),v=a.getFormatValue({cell:!0,photo:!0,filter:function(a){return"none"===a.css("border"+Helper.capitalize(h)+"Style")?"none":!0}});"mixed"===v||"default"===v||"none"===v?g.removeClass("active"):g.addClass("active")}}),$(c).click(function(){var c=$j(this),g="top"===h||"bottom"===h,v="border-"+h+"-style",w=c.hasClass("active"),b=function(a,c){w?a.css(v,"none"):"none"===c&&a.css(v,"solid")},C=function(c){g?(c.trigger(a.cellEvents.startpointychange),a.cellsHeightChanged(c)):(c.trigger(a.cellEvents.startpointxchange),a.cellsWidthChanged(c))},$=function(c){c.trigger(g?a.photoEvents.heightchange:a.photoEvents.widthchange),a.triggerPhotoRowsChange(!0,!0,c)};a.updateSelected([function(a){return a.map(function(){return $j(this).css(v)})},function(a,c){$j.each(a,function(i,a){b($j(a),c[i])}),C(a)},function(a,c){$j.each(a,function(i,a){$j(a).css(v,c[i])}),C(a)}],[function(a){return a.css(v)},function(a,c){b(a,c),$(a)},function(a,c){a.css(v,c),$(a)}])})})},bindBorderColor:function(){var a=$j("#border-color"),c=this.toolbarHelper,h=this,g={component:a,refreshComponent:function(){var a=this.component,c=h.getFormatValue({cell:!0,photo:!0,filter:function(a){return a.prop("style").borderColor.replace(/\s/g,"")}});a.data("component.select").bugFixRefresh("default"===c||"mixed"===c?"mixed":c)
}};h.toolbarComponents.push(g),a.on("change",function(){var a=$(this).val();h.updateSelected([function(a){return c.willChangeBorder(a.map(function(){return c.getBorderStyle($j(this))}))?a.map(function(){return $j(this).prop("style").borderColor}):null},function(c){c.css("borderColor",a)},function(a,c){a.each(function(i,a){$j(a).css("borderColor",c[i])})}],[function(a){return c.willChangeBorder([c.getBorderStyle(a)])?a.prop("style").borderColor:null},function(c){c.css("borderColor",a)},function(a,c){a.css("borderColor",c)}])})},bindBorderStyle:function(){var a=this,c=this.toolbarHelper,h=c.radioify($("#border-style > *"),function(h){var g=function(a,c){$j.each(["Top","Right","Bottom","Left"],function(i,h){var g="border"+h+"Style";"none"!==a.css(g)&&a.css(g,c)})};a.updateSelected([function(a){var h=a.map(function(){return c.getBorderStyle($j(this))});return c.willChangeBorder(h)?h:null},function(a){$j.each(a,function(i,a){g($j(a),h)})},function(a,c){$j.each(a,function(i,a){g($j(a),c[i])})}],[function(a){var h=c.getBorderStyle(a);return c.willChangeBorder([h])?h:null},function(a){g(a,h)},function(a,c){g(a,c)}])});this.toolbarComponents.push({refreshComponent:function(){var g=a.getFormatValue({cell:!0,photo:!0,filter:function(a){return c.getBorderStyle(a)}});h.check("default"===g||"mixed"===g?"mixed":g)}})},bindBorderWidth:function(){var a=$j("#border-width"),c=this,h=this.toolbarHelper,g={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({cell:!0,photo:!0,filter:function(a){return window.parseFloat(a.css("borderTopWidth-raw"))}}),g=a.data("defaultValue");a.data("component.select").bugFixRefresh("default"===h?g:"mixed"===h?"":h)}};c.toolbarComponents.push(g),a.on("change",function(){var a=$j(this),g=window.parseFloat(a.val()),v=g+c.units.weight,w=function(a){a.trigger(c.cellEvents.startpointxchange).trigger(c.cellEvents.startpointychange),c.cellsWidthChanged(a)},b=function(a){a.trigger(c.photoEvents.heightchange).trigger(c.photoEvents.widthchange),c.triggerPhotoRowsChange(!0,!0,a)};c.updateSelected([function(a){return a.map(function(){return $j(this).css("borderTopWidth-raw")})},function(a){a.css("borderWidth",v),w(a)},function(a,c){a.each(function(i,a){$j(a).css("borderWidth",c[i])}),w(a)}],[function(a){return h.willChangeBorder([h.getBorderStyle(a)])?a.prop("style").borderWidth:null},function(a){a.css("borderWidth",v),b(a)},function(a,c){a.css("borderWidth",c),b(a)}])}),a.find(".dropdown__list .option").tooltip({placement:"left",title:function(){return $(this).data("label")},container:".new-toolbar"})},bindMarginResize:function(){var a=this;$.each({"#font-position-top":"top","#font-position-left":"left","#font-position-right":"right","#font-position-bottom":"bottom"},function(c,h){var g=$(c);a.toolbarComponents.push({refreshComponent:function(){var c=a.getFormatValue({textContainer:!0,photo:!0,filter:function(a){var c="margin"+Helper.capitalize(h),g="data-margin-"+h;return a.attr(g)||a.css(c+"-raw")}});g.val("mixed"===c||"default"===c?"":window.parseFloat(c))}}),g.on("change",function(){var c=$j(this),g=window.parseFloat(c.val()),v=g+a.units.length,w="top"===h||"bottom"===h,b="margin"+Helper.capitalize(h),C="data-margin-"+h,$=function(c){w?a.cellsHeightChanged(c):a.cellsWidthChanged(c)},S=function(c){c.trigger(w?a.photoEvents.heightchange:a.photoEvents.widthchange),a.triggerPhotoRowsChange(!0,!0,c)};return window.isNaN(g)||0>g||g>100?void a.updateToolbox():void a.updateSelected([function(c){return a.getCellTextContainer(c).map(function(){return $j(this).attr(C)})},function(c){a.getCellTextContainer(c).css(b,v).attr(C,v),$(c)},function(c,h){a.getCellTextContainer(c).each(function(i,a){$j(a).css(b,h[i]).attr(C,h[i])}),$(c)}],[function(c){return a.getPhotoImage(c).prop("style")[b]},function(c){a.getPhotoImage(c).css(b,v),S(c)},function(c,h){a.getPhotoImage(c).css(b,h),S(c)}])})})},bindCellBackground:function(){var a=$j("#cell-background"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({cell:!0,photo:!0,filter:function(a){var h=a.css("backgroundColor").replace(/\s/g,""),g=c.getColorValueOfCss(h);return g?h:"transparent"}});a.data("component.select").bugFixRefresh("default"===h||"mixed"===h?"mixed":h)}};c.toolbarComponents.push(h),a.on("change",function(){var a=$(this).val();c.updateSelected([function(a){return a.map(function(){return $j(this).prop("style").backgroundColor})},function(c){c.css("backgroundColor",a)},function(a,c){a.each(function(i,a){$j(a).css("backgroundColor",c[i])})}],[function(a){return a.prop("style").backgroundColor},function(c){c.css("backgroundColor",a)},function(a,c){a.css("backgroundColor",c)}])})},bindCellWidth:function(){var a=$j("#cell-width"),c=(a.find(".cell-width-trigger"),this),h={component:a,defaultValue:"",refreshComponent:function(){var a=this.component,h=c.getSelectedCells(),g=h.length,v=c.getFormatValue({cell:!0,filter:function(a){return a.css("width-raw")}}),w=function(){var a=window.parseFloat(v);return window.isNaN(a)?a:c.roundDecimal(a,4)}(),b=function(c,h,g){{var v=a;a.find(".icon-only-text")}v.removeAttr("disabled"),c&&v.attr("disabled","disabled"),v.val(h).attr("title",g)};"auto"===v?b(!0,"自动计算","自动计算为撑满所在行的余下宽度"):h.not(":last-child").length<g||h.parents(".row").length<g?b(!0,window.isNaN(w)?"n/a":w+" %","无法同时修改选中的单元格的宽度"):b(!1,window.isNaN(w)?"":w,"")}};c.toolbarComponents.push(h),a.on("change",function(){var a=window.parseFloat($j(this).val());return window.isNaN(a)?void c.updateToolbox():void c.updateSelected([function(h){var g=$j(),v=[];return $j.each(h.not(":last-child"),function(i,h){var w=$j(h),b=w.parents(".row"),C=b.find(".cell"),$=c.getCellMinWidthPercent(b),S=100-$*(C.length-1);a>$&&S>a&&(g=g.add(w),$j.each(C,function(i,a){var c=$j(a);v.push({cell:c,width:c.prop("style").width})}))}),g.length>0?{willBeChangedCells:g,mayBeChangedCells:v}:null},function(h,g){$j.each(g.willBeChangedCells,function(i,h){var g=$j(h);g.css("width",a+"%"),c.validateRowWidth(g.siblings(".cell"),100-a)}),c.cellsWidthChanged(g.willBeChangedCells)},function(a,h){$j.each(h.mayBeChangedCells,function(i,a){a.cell.css("width",a.width)}),c.cellsWidthChanged(h.willBeChangedCells)}])})},bindLineHeight:function(){var a=$j("#line-height"),c=this,h={component:a,refreshComponent:function(){var a=this.component,h=c.getFormatValue({text:!0,filter:function(a){var c=a.attr("data-line-height");return window.parseFloat(c)}}),g=a.data("defaultValue");a.data("component.select").bugFixRefresh("default"===h?g:"mixed"===h?"mixed":h)}};c.toolbarComponents.push(h),a.click(function(){var a=$(this).val();c.updateSelected([function(a){return c.getCellTextDirectly(a).map(function(){return $j(this).attr("data-line-height")})},function(h){c.getCellTextDirectly(h).css("lineHeight",a).attr("data-line-height",a),c.cellsHeightChanged(h)},function(a,h){c.getCellTextDirectly(a).each(function(i,a){$j(a).css("lineHeight",h[i]).attr("data-line-height",h[i])}),c.cellsHeightChanged(a)}])})},bindCRSBinding:function(){var a=$j("#crs-binding"),c=this;a.tooltip({placement:"top",trigger:"manual"}),a.off("click").click(function(){var h=c.getSelectedSections(),g=c.getExposeSectionPopup(h),v=JSON.parse($j("input#resume_keys").val()),w=c.getKeysFromObject(v),b=function(a,h){return c.distinct((c.isNullable(h)?[]:h).concat($j.map(a,function(a){return c.getKeyField($j(a)).val()})),function(a){return""!==$j.trim(a)})},C=function(a){return $j('<div style="font-size: 14px; font-weight: bold; color: #333;"></div>').html(a)},$=[],S=[],y=function(a){var v=c.getKeyField(a),w=a.is(".section"),b=$j('<input type="text" class="text border_box" />').attr({value:v.val()}).css({width:"100%",textAlign:a.css("textAlign"),paddingRight:"0"}).off("focus").focus(function(){c.addMask(a,"add").css("zIndex",g.zIndex)}).off("blur").blur(function(){c.clearMask(h)});return S.push(function(){var a=$j.trim(b.val()),c=v.val();return a!==c?{newKey:a,oldKey:c,keyField:v}:null}),$.push($j.extend({},BaseComboBox,{textSelector:function(){return b},dropdownListOptions:function(a){return{triggerGroupSelector:function(){return"."+a.triggerClassName()}}},isForSectionKey:w})),b},j=function(a,c){return a.empty(),$j.each(c,function(i,c){a.append($j("<li></li>").text(c))}),a},R=function(a){var h=$j('<ul class="dropdown plain"></ul>');return c.notNullable(a)&&a.length>0&&j(h,a),h},P=y(h),k=function(){$j.each($,function(i,a){a.isForSectionKey||(j(a.getDropdown(),b(h.find(".cell"),v[$j.trim(P.val())])),a.dropdownListUpdated())})},T=C("整段内容绑定").add($j('<div style="margin: 5px 5px 20px;"></div>').html(P.off("change").change(function(){k()})).append(R(b($j(".section"),w)))).add(C("单元格内容绑定"));return 1!==h.length?void c.toolbarHelper.flashTip(a,"请选中一个单元格",2e3):($j.each(h.find(".row"),function(i,a){var c=$j(a),h=$j("<tr></tr>");$j.each(c.find(".cell"),function(a,c){var g=$j(c);h.append($j("<td></td>").css({width:g.css("width-raw")}).html(y(g)).append(R()))}),T=T.add($j('<table style="width: 100%;" border="0" cellspacing="5" cellpadding="0"></table>').html(h))}),g.setContent(T.add($j('<div style="margin-top: 10px; text-align: center;"></div>').append(g.createButton("保存").off("click").click(function(){var a=[],v=function(g){$j.each(a,function(i,a){a.keyField.val(a[g?"oldKey":"newKey"])}),c.updateLibraryVisibleOfSection(h,c.getLibraryVisible())};$j.each(S,function(i,h){var g=h();c.notNullable(g)&&a.push(g)}),a.length>0&&c.updateResume(function(){v(!1)},function(){v(!0)}),g.hide()}).css("margin-right","30px")).append(g.createCancelLink()))),g.show(),$j.each($,function(i,a){a.enable()}),$j.each($,function(i,a){a.updateTriggerPosition()}),void k())})},bindCRSAdd:function(){var a=$j("#add-crs"),c=this.toolbarHelper,h="请选中一个单元格",g="超过了行的限制",v=this;$("#add-row-bottom").click(function(){var g=v.getSelectedSections();1===g.length?v.insertRow(v.getSelectedRows(g).last(),!0):c.flashTip(a,h,3e3)}).hover(function(){var a,c=v.getSelectedSections();1===c.length&&(a=v.getSelectedRows(c).last(),v.addMask(a,"add"),v.buildInserter().prependTo(a))},function(){var a=v.getSelectedSections();v.clearInserter(a),v.clearMask(a),v.clearCellInserter(a)}),$("#add-section-bottom").click(function(){var g=v.getSelectedSections();1===g.length?v.insertSection(g,!0):c.flashTip(a,h,3e3)}).hover(function(){var a=v.getSelectedSections();1===a.length&&(v.addMask(a,"add"),v.buildInserter().prependTo(a))},function(){var a=v.getSelectedSections();v.clearInserter(a),v.clearMask(a),v.clearCellInserter(a)}),$("#add-cell-right").click(function(){var w,b=v.getSelectedSections(),C=!0;1===b.length?(C=v.ifInsert(b,!1).canInsert,w=v.ifInsert(b,!1).adjacentCells,C?w.length>0&&v.insertCells(w,!1):c.flashTip(a,g,3e3)):c.flashTip(a,h,3e3),v.clearInserter(b),v.clearMask(b),v.clearCellInserter(b)}).hover(function(){var a,c=v.getSelectedSections();1===c.length&&(a=v.getSelectedRows(c),$j.each(a,function(i,a){var c=$j(a),h=v.getSelectedCells(c),g=h.last();v.addCellInserter(g,!1),v.addMask(g,"add")}))},function(){var a=v.getSelectedSections();v.clearInserter(a),v.clearMask(a),v.clearCellInserter(a)}),$("#add-cell-left").click(function(){var w,b=v.getSelectedSections(),C=!0;1===b.length?(C=v.ifInsert(b,!0).canInsert,w=v.ifInsert(b,!0).adjacentCells,C?w.length>0&&v.insertCells(w,!0):c.flashTip(a,g,3e3)):c.flashTip(a,h,3e3),v.clearInserter(b),v.clearMask(b),v.clearCellInserter(b)}).hover(function(){var a,c=v.getSelectedSections();1===c.length&&(a=v.getSelectedRows(c),$j.each(a,function(i,a){var c=$j(a),h=v.getSelectedCells(c),g=h.last();v.addCellInserter(g,!0),v.addMask(g,"add")}))},function(){var a=v.getSelectedSections();v.clearInserter(a),v.clearMask(a),v.clearCellInserter(a)})},ifInsert:function(a,c){var h,g,v=this,w=!0;return h=v.getSelectedRows(a),g=$j(),$j.each(h,function(i,a){var h=$j(a),b=v.getCellMinWidthPercent(h),C=v.getSelectedCells(h),$=(c===!0,C.last());g=g.add($),b*(h.find(".cell").length+1)>100&&(w=!1)}),{canInsert:w,adjacentCells:g}},bindCRSRm:function(){var a=$j("#rm-crs"),c=(a.find(".dropdown-menu li"),this),h="请选中一个单元格",g=this.toolbarHelper,v=function(a){c.clearInserter(a),c.clearMask(a),c.clearCellInserter(a)};$("#rm-section").click(function(){0===c.getSelectedSections().length?g.flashTip(a,h,3e3):c.delCell(c.getSelectedSections().find(".cell"))}).hover(function(){$(".addMinus").css("backgroundPosition","-21px 0");var a=c.getSelectedSections();c.addMinusSigh(a.find(".cell"));for(var i=0,h=a.length;h>i;i++)c.addMask($(a[i]),"remove")},function(){$(".addMinus").css("backgroundPosition","0 0");var a=c.getSelectedSections();v(a)}),$("#rm-row").click(function(){0===c.getSelectedRows().length?g.flashTip(a,h,3e3):c.delCell(c.getSelectedRows().find(".cell"))}).hover(function(){$(".addMinus").css("backgroundPosition","-21px 0");var a=c.getSelectedSections();0!==a.length&&$j.each(c.getSelectedRows(a),function(i,a){var h=$j(a);c.addMask(h,"remove")})},function(){$(".addMinus").css("backgroundPosition","0 0");var a=c.getSelectedSections();v(a)}),$("#rm-cell").click(function(){0===c.getSelectedCells().length?g.flashTip(a,h,3e3):c.delCell()}).hover(function(){$(".addMinus").css("backgroundPosition","-21px 0");var a=c.getSelectedSections();0!==a.length&&$j.each(c.getSelectedCells(a),function(i,a){var h=$j(a);c.addMask(h,"remove")})},function(){$(".addMinus").css("backgroundPosition","0 0");var a=c.getSelectedSections();v(a)})},bindResumeSpace:function(){var a=this;$.cssHooks.space={get:function(a){var c=["top","bottom"],h={};return $.each(c,function(c,g){h[g]=window.parseInt($.style(a,"padding"+Helper.capitalize(g)),10)||0}),h},set:function(c,h){var g=function(){var h=a.getPostionOfRow(c);return"first"===h?["bottom"]:"last"===h?["top"]:["top","bottom"]}();h="object"!=typeof h?{top:h,bottom:h}:h,$.each(g,function(a,g){var v=h[g];void 0!==h[g]&&$(c).css("padding"+Helper.capitalize(g),window.parseInt(v,10)+"mm")})}};var c=function(c,h){var g=a.getSpaceContextRows();g.each(function(){a.setSpaceOfRow($(this),c,h)}),a.updateSpaceStatus()},h=function(c){var h=g();c();var v=g(),w=function(c){var h=$j();$.each(c,function(i,a){a.row.css("space",a.space),h=h.add(a.row)}),a.isAnyRowAffectedByPhoto(h)&&a.triggerPhotoRowsChange(!0,!0),h.trigger("space"),a.getResume().trigger(a.resumeEvents.heightchange),a.updateSpaceStatus()};a.updateResume(function(){w(v)},function(){w(h)})},g=function(){var c=a.getSpaceContextRows();return c.map(function(){var a=$(this);return{row:a,space:a.css("space")}})},v=function(g,v,w){var b,C,S=0,y=null,j=0>w?"":"+",R=g.parents(".editor-number").find(".editor-number__view"),P=function(){S+=w,R.val(b!==!1?b+S:j+S)};g.on("mousedown",function(){$(this).hasClass("disable")||(b=window.isNaN(window.parseInt(R.val(),10))?!1:Number(R.val()),P(),y=setTimeout(function(){P(),y=setTimeout(arguments.callee,100)},1e3),C=!0)}).on("mouseup mouseleave",function(){C===!0&&($(this).hasClass("disable")||h(function(){c(a.getRowSpaceStrategy()?S:function(){var a={};return a[v]=S,a}())}),C=!1,window.clearTimeout(y),S=0)})},w=function(g,v){g.on("change",function(){var g=window.parseInt($(this).val(),10);!window.isNaN(g)&&g>=0?h(function(){a.getRowSpaceStrategy()?c(g,!0):c(function(){var a={};return a[v]=g,a}(),!0)}):a.updateSpaceStatus()})};v($(".editor-number__plus",$("#row-space-top")),"top",1),v($(".editor-number__minus",$("#row-space-top")),"top",-1),w($(".editor-number__view",$("#row-space-top")),"top"),v($(".editor-number__plus",$("#row-space-bottom")),"bottom",1),v($(".editor-number__minus",$("#row-space-bottom")),"bottom",-1),w($(".editor-number__view",$("#row-space-bottom")),"bottom"),$("#row-space-top .editor-number__minus, #row-space-bottom .editor-number__minus").tooltip().on("show",function(){return $(this).hasClass("disable")?void 0:!1}),$("#join-row-space").click(function(){$(this).toggleClass("active")}).find(".checkbox").tooltip({container:".new-toolbar"}),this.updateSpaceStatus()},getRowSpaceStrategy:function(){return $("#join-row-space").hasClass("active")},getPostionOfRow:function(a){var c=$(a);return 0===c.index(".row")?"first":c.index(".row")===$(".row").length-1?"last":"middle"},getSpaceContextRows:function(){var a=this.getSelectedRows();return 0===a.length?$(".row",this.getResumeContainer()):a},updateSpaceStatus:function(){var a=this,c=this.getSpaceContextRows(),h=[],g=[],v=[],w=$(".space-component--all-space"),b=$(".space-component__text",w).val(""),C=$(".space-component__decrease",w).removeClass("disable"),S=$("#row-space-top"),y=$(".editor-number__view",S).val(""),j=$(".editor-number__minus",S).removeClass("disable"),R=$("#row-space-bottom"),P=$(".editor-number__view",R).val(""),k=$(".editor-number__minus",R).removeClass("disable");c.each(function(){var c=$(this),h=c.css("space"),w=a.getPostionOfRow(c);"first"===w?v.push(h.bottom):"last"===w?g.push(h.top):(g.push(h.top),v.push(h.bottom))}),1===Helper.distinct(g).length&&(y.val(g[0]),h.push(g[0]),0===g[0]&&this.changeBottomSpaceStatus(j,!0)),1===Helper.distinct(v).length&&(P.val(v[0]),h.push(v[0]),0===v[0]&&this.changeBottomSpaceStatus(k,!0)),2===h.length&&h[0]===h[1]&&(b.val(h[0]),0===h[0]&&this.changeBottomSpaceStatus(C,!0))},changeBottomSpaceStatus:function(a,c){c?a.addClass("disable"):a.removeClass("disable")},getSpaceOfRow:function(a){return{t:a.css("space").top,b:a.css("space").bottom}},setSpaceOfRow:function(a,c,h){var g=function(a,c){var h=["top","bottom"],g={};return c="object"!=typeof c?{top:c,bottom:c}:c,$.each(h,function(h,v){g[v]=a[v]+(c[v]||0)}),g};if(h)a.css("space",c);else{var v=a.css("space");a.css("space",g(v,c))}},updateAllSpace:function(){$(".row",this.getInnerResume()).trigger("space")},bindUndoRedoComponent:function(){var a=$j("#undo"),c=$j("#redo"),h=this;a.off("click").click(function(){h.Undo.doUndo()}),c.off("click").click(function(){h.Undo.doRedo()}),this.addHotkey(a,90,!0,!1,function(){h.Undo.doUndo()}),this.addHotkey(c,89,!0,!1,function(){h.Undo.doRedo()}),this.addHotkey(c,90,!0,!0,function(){h.Undo.doRedo()})},bindMargin:function(){var a=this.getResumeContainer(),c=this.getResume(),h=this.getResumeSize(c),g=this.getResumePosition(c),v=this.getInnerResume(c),w=this.getResumeMargin(v),b=$j('<div class="horizontal slider"></div>').css("width",h.width+this.units.length).appendTo(a),C=$j('<div class="vertical slider"></div>').css("height",h.height+this.units.length).appendTo(a),S=this.getSliderSpacing(),y=this,j={left:function(){return y.getResumePosition(c).left},top:function(){return y.getResumePosition(c).top-b.outerHeight()-S.v}},R={left:function(){return y.getResumePosition(c).left-C.outerWidth()-S.h},top:function(){return y.getResumePosition(c).top}},P=function(){b.css({left:j.left()+"px",top:j.top()+"px"}),C.css({left:R.left()+"px",top:R.top()+"px"})},k=$j('<div class="page_margin l"><input type="text"/>mm</div>').appendTo(a),T=this.toolbarHelper.numberify($("#page-space-left"),.1),I=$j('<div class="page_margin r"><input type="text"/>mm</div>').appendTo(a),N=this.toolbarHelper.numberify($("#page-space-right"),.1),E=$j('<div class="page_margin t"><input type="text"/></div>').appendTo(a),H=this.toolbarHelper.numberify($("#page-space-top"),.1),M=$j('<div class="page_margin b"><input type="text"/></div>').appendTo(a),A=this.toolbarHelper.numberify($("#page-space-bottom"),.1),B={min:0,range:!0,step:.1},_=y.prepareRuler("for_vertical_slider","vertical",!1,!1),F=y.prepareRuler("for_horizontal_slider","horizontal",!1,!1),D=function(a){_.css({top:b.position().top+b.outerHeight()+"px",left:y.getResumePosition(c).left+"px",marginLeft:a+y.units.length}).height(c.outerHeight()+S.v).show()},L=function(a){F.css({left:C.position().left+C.outerWidth()+"px",top:y.getResumePosition(c).top+"px",marginTop:h.height-a+y.units.length}).show()},W=function(a){var g=y.getPaddingOfMargin(v),w=function(){var c=y.getResumeMargin(v),g=v.prop("style");if(a){var w=C.slider("values");return{newVSliderValues:w,oldVSliderValues:[c.bottom,h.height-c.top],pageMarginBottom:w[0],pageMarginTop:h.height-w[1],oldPageMarginBottom:g.marginBottom,oldPageMarginTop:g.marginTop}}var $=b.slider("values");return{newHSliderValues:$,oldHSliderValues:[c.left,h.width-c.right],pageMarginLeft:$[0],oldPageMarginLeft:g.marginLeft,pageMarginRight:h.width-$[1],oldPageMarginRight:g.marginRight}}(),$=function(c,h){c.slider("disable"),c.slider("values",h),c.slider("enable"),a?(O(M,a,0,A),O(E,a,1,H)):(O(k,a,0,T),O(I,a,1,N))},S=function(h){a?(v.css({marginTop:h?w.oldPageMarginTop:w.pageMarginTop-g.top+y.units.length,marginBottom:h?w.oldPageMarginBottom:w.pageMarginBottom-g.bottom+y.units.length}),c.trigger(y.resumeEvents.heightchange),$(C,h?w.oldVSliderValues:w.newVSliderValues),y.updatePageMark(!0),y.isEndOfPage()&&y.togglePageMarkWarn(!0)):(v.css({marginLeft:h?w.oldPageMarginLeft:w.pageMarginLeft-g.left+y.units.length,marginRight:h?w.oldPageMarginRight:w.pageMarginRight-g.right+y.units.length}),y.triggerPhotoRowsChange(!1,!1),c.trigger(y.resumeEvents.widthchange).trigger(y.resumeEvents.heightchange),$j.each(v.find(".cell"),function(i,a){var c=$j(a);c.trigger(y.cellEvents.widthchange),y.triggerCellYChange(c)}),$(b,h?w.oldHSliderValues:w.newHSliderValues),y.updatePageMark(!0))};y.updateResume(function(){S(!1)},function(){S(!0)})},O=function(a,c,g,v){var w=c?C:b,$=c?R:j,S=w.slider("values",g),P=2,k=S;g>0&&(k=c?h.height-S:h.width-S),a.css(c?{left:$.left()-a.outerWidth()-P+"px",top:$.top()-a.outerHeight()/2+"px",marginTop:h.height-S+y.units.length}:{top:$.top()-a.outerHeight()-P+"px",left:$.left()-a.outerWidth()/2+"px",marginLeft:S+y.units.length}),a.find("input").val(y.roundDecimal(k,1)),v.set(y.roundDecimal(k,1))},V=function(){var a=y.getPaddingOfMargin(v);return{width:10+Math.max(a.left+a.right,window.parseFloat(y.getPhotoImage().css("width-raw"))),height:a.top+a.bottom}};return y.getPageMark().attr("title","一页 A4 纸打印警戒线").css({marginLeft:g.left+"px",marginTop:g.top+"px"}).append($j('<div class="warn-info" />').append($j('<span class="content"/>').text("超过此线，打印会超过一页！")).append($j("<span />").addClass("close").click(function(){return y.togglePageMarkWarn(!1),!1}))).off("click").click(function(){$j(this).is(":animated")||$j(this).find(".warn-info").is(":animated")||$j(this).find(".close").is(":animated")||y.togglePageMarkWarn()}),b.slider($j.extend({},B,{orientation:"horizontal",max:h.width,create:function(){y.updatePageMark(!1)},start:function(a,ui){var c=ui.value;D(c)},slide:function(a,ui){var c=ui.value,h=ui.values;return h[1]-h[0]<V().width?!1:(D(c),O(k,!1,0,T),void O(I,!1,1,N))},change:function(){b.slider("option","disabled")||W(!1)},stop:function(a,ui){_.hide(),y.updatePageMark(!1,ui.values[0])},values:[w.left,h.width-w.right]})),C.slider($j.extend({},B,{orientation:"vertical",max:h.height,create:function(){y.updatePageMark(!0)},start:function(a,ui){var c=ui.value;L(c)},slide:function(a,ui){var c=ui.value,h=ui.values;return h[1]-h[0]<V().height?!1:(L(c),O(M,!0,0,A),void O(E,!0,1,H))},change:function(){C.slider("option","disabled")||W(!0)},stop:function(a,ui){F.hide(),y.updatePageMark(!0,ui.values[0]),y.isEndOfPage()&&y.togglePageMarkWarn(!0)},values:[w.bottom,h.height-w.top]})),P(),$j.each([[k,!1,0,T],[I,!1,1,N],[M,!0,0,A],[E,!0,1,H]],function(i,a){var c=a[0],g=a[1],v=a[2],w=a[3],$=function(){var a=window.parseFloat($j(this).val()),$=0>=v,S=g?C:b,y=g?h.height:h.width,j=$?a:y-a,R=S.slider("values",1-v),P=$?R-j:j-R,k=g?V().height:V().width,T=!window.isNaN(a)&&a>=0&&P>k;T?S.slider("values",v,j):O(c,g,v,w)};O(c,g,v,w),y.fixTextInput(c.find("input").off("change").change($)),w.$view.off("change").change($)}),c.on(y.resumeEvents.widthchange,function(){F.width(c.outerWidth()+S.h)}),c.on(y.resumeEvents.heightchange,function(){y.isEndOfPage()&&y.getShowEndOfPageWarnFlag()&&y.togglePageMarkWarn(!0),_.height(c.outerHeight()+S.v)}),this},bindPhoto:function(){var a=this.getInnerResume(),c=this.getPhoto(a),h=this,g=h.getHolderClass(),v=$j('<div class="'+g+'"></div>').prependTo(c),w=h.getGridLineClass(),b=h.getOutlineClass(),C=$j('<div class="t '+w+'"></div>').css("opacity","0.3");return v.css("zIndex",2).append('<div class="l '+w+'"></div>').append('<div class="t '+w+'"></div>').append(C).append('<div class="l '+b+'"></div>').append('<div class="t '+b+'"></div>').append('<div class="r '+b+'"></div>').append('<div class="b '+b+'"></div>'),c.attr("title",h.photoPrompt).on(h.photoEvents.dblclick,function(){$j("#photo-setting").click()}).on(h.photoEvents.widthchange,function(){v.width(c.outerWidth()).css({marginLeft:0-h.getBorderWeight(c,"left")+h.units.weight})}).on(h.photoEvents.heightchange,function(){var a=h.getPhotoImage(c);v.css({marginTop:0-h.getBorderWeight(c,"top")+h.units.weight}),C.css("top",window.parseFloat(a.css("height-raw"))+window.parseFloat(a.css("marginTop-raw"))+window.parseFloat(a.css("marginBottom-raw"))+h.units.converters.pt2mm(h.getBorderWeight(c,"top"))+h.units.length)}).on(h.photoEvents.alignchange,function(){var g=h.getPhotoAlign(c),v=function(){return"left"===g?"right":"left"}(),w=h.getPhotoAffectedCssProperty(g),b=h.getPhotoAffectedCssProperty(v);$j.each(a.find(".row"),function(i,a){var c=$j(a),g=h.getPhotoAffectedCssValue(c,v);g>0&&c.css(b,"").css(w,g+h.units.length).find(".cell:not(:last-child)").trigger(h.cellEvents.widthchange)})}).on(h.photoEvents.rowschange,function(){var g,w=h.getPhotoImage(c),b=w.is("img"),C=window.parseFloat(w.css("width-raw"))+window.parseFloat(w.css("marginLeft-raw"))+window.parseFloat(w.css("marginRight-raw"))+h.units.converters.pt2mm(h.getBorderWeight(c,"left")+h.getBorderWeight(c,"right")),$=h.getPhotoAffectedHeight(c,w),S=h.getPhotoAlign(c),y=function(a){h.photoEvents.addChangedRow(a)},j=0;h.photoEvents.clearChangedRows(),$j.each(a.find(".section"),function(i,a){var c=$j(a);$j.each(c.find(".row"),function(a,c){var v=$j(c);b&&$>j?(h.roundDecimal(C,2)!==h.roundDecimal(h.getPhotoAffectedCssValue(v,S),2)&&(v.css(h.getPhotoAffectedCssProperty(S),C+h.units.length),y(v,!0)),g=v,j+=v.outerHeight()):h.isAffectedByPhoto(v)&&(v.css(h.getPhotoAffectedCssProperty(S),""),y(v,!1))})}),j=function(){var c=a.find(".row"),h=c.eq(c.index(g)+1);return 0===h.length?j:j+window.parseInt(h.css("paddingTop"),10)}(),v.height(j),c.height(j)}).trigger(h.photoEvents.widthchange).trigger(h.photoEvents.heightchange).trigger(h.photoEvents.rowschange).trigger(h.photoEvents.alignchange),h.photoEvents.getChangedRows().length>0&&h.dirtyResume(),this},blurAllTextarea:function(a){this.isNullable(a)&&(a=this.getInnerResume()),a.find(".cell textarea").blur()},bindSections:function(){var a=this.getResume(),c=this.getInnerResume(a),h=this.getGridLineClass(),g=$j('<div class="l '+h+'"></div>').appendTo(c),v=$j('<div class="r '+h+'"></div>').appendTo(c),w=$j('<div class="b '+h+'"></div>').appendTo(c),b=this;return a.on(b.resumeEvents.widthchange,function(){var a=b.getPaddingOfMargin(c);g.css("marginLeft",a.left+b.units.length),v.css("marginRight",a.right+b.units.length),w.width(c.width()).css("marginLeft",a.left+b.units.length)}).on(b.resumeEvents.heightchange,function(){var a=b.getPaddingOfMargin(c);v.height(c.height()).css("marginTop",a.top+b.units.length),g.height(c.height()).css("marginTop",a.top+b.units.length),w.css("marginBottom",a.bottom+b.units.length)}).on(b.resumeEvents.gridlineheightchange,function(){v.height(c.height()),g.height(c.height())}),a.selectable({cancel:":input, option, "+$j.map([b.getResizeHandleClassName(),b.getRowHandleClassName(),b.getSectionHandleClassName()],function(a){return"."+a}).join(", "),filter:".cell, .photo",start:function(){b.blurAllTextarea(c)},stop:function(){var a=b.getSelectedCells(c),h=b.getSelectedPhoto(c);b.updateToolbox(a,h),b.updateSpaceStatus(),setTimeout(function(){b.addMinusSigh()},0)},selected:function(){b.updateSortHandler()},unselected:function(){b.updateSortHandler()},selecting:function(a,ui){var c=$j(ui.selecting);c.prev().find(".resize_handle").addClass("show")},unselecting:function(a,ui){var c=$j(ui.unselecting);c.prev().find(".resize_handle").removeClass("show")}}),c.sortable(b.getSortableOptions({items:".section",handle:"."+b.getSectionHandleClassName()})),b.fixJQueryUISortable(c),$j.each(c.find(".section"),function(i,a){var c=$j(a);b.bindSection(c)}),a.trigger(b.resumeEvents.widthchange).trigger(b.resumeEvents.heightchange),this},bindSection:function(a){var c=this;return a.sortable(c.getSortableOptions({items:".row",handle:"."+c.getRowHandleClassName(),connectWith:".section"})),c.fixJQueryUISortable(a),$j.each(a.find(".row"),function(i,a){var h=$j(a);c.bindRow(h)}),this},validateRowWidth:function(a,c){var h=this,g=function(){var a=window.parseFloat(c);return window.isNaN(a)||a>100?100:0>=a?1:a}(),v=g/a.length,w=h.getCellMinWidthPercent(a.first()),b=w>v,C=0;$j.each(a,function(i,a){var c=$j(a),g=c.is(":last-child");return b?(c.css("width",g?"auto":v+"%"),!0):(g?c.css("width","auto"):c.css("width-raw").indexOf("%")<0&&c.css("width",h.toPercentWidth(c.outerWidth(),h.getFullWidth(c))+"%"),void(C+=function(){var a=window.parseFloat(c.css("width-raw"));return window.isNaN(a)?a=w:w>a&&(a=w,c.css("width",a+"%")),a}()))}),b||(g-=w,C-=w,C>g&&$j.each(a.not(":last-child").sort(function(x,a){var c=function(a){return window.parseFloat($j(a).css("width-raw"))};return c(x)-c(a)}),function(i,a){var c=$j(a),h=window.parseFloat(c.css("width-raw")),v=Math.max(w,h*(g/C));c.css("width",v+"%"),g-=v,C-=h}))},bindRow:function(a){var c=this,h=a.find(".cell"),g=function(){var a=$(".row",c.getResumeContainer()),h=$(this),g=a.index(h),v=0===g?$():a.eq(g-1),w=function(){var w=h.css("space"),b=v.css("space")||{top:0,bottom:0},C=function(){var v;return v="last"===c.getPostionOfRow(h)?{top:0,bottom:0}:a.eq(g+1).length>0?a.eq(g+1).css("space"):{top:0,bottom:0}}();return{top:w.top+b.bottom,bottom:w.bottom+C.top}}();0===w.bottom?h.find(".b.grid_line").addClass("hidden"):h.find(".b.grid_line").removeClass("hidden"),0===w.top?v.find(".b.grid_line").addClass("hidden"):v.find(".b.grid_line").removeClass("hidden")};return c.validateRowWidth(h,100),$j.each(h,function(i,a){var h=$j(a);c.bindCell(h)}),a.on("space",g).trigger("space"),this},bindCell:function(a){var c=this.getResume(),h=this.getInnerResume(c),g=this,v=!a.is(":last-child"),w=8,b=g.getResizeHandleClassName(),C=v?$j('<div class="'+b+'" title="左右拖动，调整宽度"></div>').width(w):null,$=.5*w,S=g.getCellMinWidth(),y=function(){return a.next(".cell")},j=g.getHolderClass(),R=$j('<div class="'+j+'"></div>'),P=g.getGridLineClass(),k=g.getOutlineClass(),T=g.getCellTextContainer(a),I=g.getCellText(T),N={},E=$j('<div class="ruler vertical"></div>'),H=function(a){return"left_"+g.ceilDecimal(a,0)},M=function(c){var h=H(c),v=N[h];E.remove(),g.notNullable(v)&&v.length>0&&E.appendTo("body").css(function(){var h=a.offset().top,g=Math.min(v[0].offset().top,h),w=Math.max(function(){var a=v[v.length-1];return a.offset().top+a.height()}(),h+C.height());return{top:g+"px",height:w-g+"px",left:c+"px",marginLeft:$+"px",display:"block"}}())},A=function(c,ui,h){var v=g.getFullWidth(a),w=y(),b=a.outerWidth()+w.outerWidth(),S=ui.position.left+$,j=S-a.position().left,R=b-j,P=g.toPercentWidth(j,v)+"%",k=w.is(":last-child")?"auto":g.toPercentWidth(R,v)+"%",T=C.draggable("option","oldCellWidth").oldCellPercentWidth,I=C.draggable("option","oldCellWidth").oldNextCellPercentWidth,N=function(){g.cellsWidthChanged(a),g.simulateFakeThread(function(){a.add(w).is("."+g.getSelectedClass())&&g.updateToolbox()})},E=function(){a.css("width",P),w.css("width",k),N()},H=function(){a.css("width",T),y().css("width",I),N()};h?g.updateResume(E,H):E()};a.find("."+j).remove(),R.prependTo(a).html('<div class="l '+P+'"></div><div class="t '+P+'"></div><div class="b '+P+'"></div><div class="l '+k+'"></div><div class="t '+k+'"></div><div class="r '+k+'"></div><div class="b '+k+'"></div>'),a.find("."+b).remove();var B=a.css("borderTopWidth-raw");("1pt"===B||"0.5pt"===B)&&(a.css("borderWidth","0.75pt"),"0.5pt"===B&&a.css("borderStyle","none")),v?C.prependTo(a).draggable({addClasses:!1,axis:"x",cursor:"e-resize",scroll:!1,start:function(c,ui){var v=ui.offset.left;$j(this).draggable("option","oldCellWidth",{oldCellPercentWidth:a.prop("style").width,oldNextCellPercentWidth:y().prop("style").width}),N={},$j.each(h.find("."+b),function(i,a){var c=$j(a).parents(".cell"),h=c.offset().left+c.outerWidth(),v=H(h-$),w=N[v];
g.isNullable(w)&&(w=[]),w.push(c),N[v]=w}),M(v)},drag:function(a,ui){var c=ui.offset.left;A(a,ui),M(c)},stop:function(a,ui){E.remove(),A(a,ui,!0)}}).append($j('<div class="resize-icon border_box" />')):a.css("width","auto"),a.off(g.cellEvents.widthchange).on(g.cellEvents.widthchange,function(){var c=a.outerWidth();R.width(c),g.notNullable(C)&&C.draggable("option","containment",[a.offset().left-$+S,0,function(){var a=y();return a.offset().left+a.outerWidth()-$-S}(),0]).css({left:a.position().left+c-$+"px"}),g.fixTextEditor(T.find("textarea"),T)}).off(g.cellEvents.startpointxchange).on(g.cellEvents.startpointxchange,function(){R.css({marginLeft:a.position().left-T.position().left+"px"})}).off(g.cellEvents.heightchange).on(g.cellEvents.heightchange,function(){var c,h,g,v=a.find("pre"),w=v.find("span"),b=function(a,c){return Math.round(window.parseFloat(a)/window.parseFloat(c))},C=0,$=0,S=0,y=0,j=[];if(w.attr("data-line-height")?w.css("lineHeight",w.attr("data-line-height")):w.attr("data-line-height",w.css("lineHeight-raw")),v.attr("data-margin-top")?v.css("marginTop",v.attr("data-margin-top")):v.attr("data-margin-top",v.css("marginTop-raw")),v.attr("data-margin-bottom")?v.css("marginBottom",v.attr("data-margin-bottom")):v.attr("data-margin-bottom",v.css("marginBottom-raw")),c=w.css("line-height"),h=v.css("marginTop"),g=v.css("marginBottom"),c&&-1!==c.indexOf("px")){var R=window.parseFloat(c);if(C=Math.ceil(R)-R,C>0){var P=b(v.height(),R);y+=C*P,j.push({handler:function(a){a?w.css("lineHeight",Math.ceil(R)+"px"):w.css("lineHeight",Math.floor(R)+"px")},factor:P,value:C*P})}}var k=window.parseFloat(h);$=Math.ceil(k)-k,$>0&&(y+=$,j.push({handler:function(a){a?v.css("marginTop",Math.ceil(k)+"px"):v.css("marginTop",Math.floor(k)+"px")},factor:1,value:$}));var N=window.parseFloat(g);S=Math.ceil(N)-N,S>0&&(y+=S,j.push({handler:function(a){a?v.css("marginBottom",Math.ceil(N)+"px"):v.css("marginBottom",Math.floor(N)+"px")},factor:1,value:$})),j.length&&(j.sort(function(a,c){return a.factor-a.value-(c.factor-c.value)}),$j.each(j,function(i,a){var c=y-a.factor;0>c?a.handler(!0):(a.handler(!1),y=c)})),T.css("minHeight",I.css("lineHeight"))}).on(g.cellEvents.heightchange,function(){var c=a.outerHeight();R.height(c),g.notNullable(C)&&C.height(c)}).off(g.cellEvents.startpointychange).on(g.cellEvents.startpointychange,function(){var c=a.position().top-T.position().top+"px";R.css({marginTop:c}),g.notNullable(C)&&C.css({marginTop:c})}).trigger(g.cellEvents.fontsizechange).trigger(g.cellEvents.widthchange).trigger(g.cellEvents.startpointxchange).trigger(g.cellEvents.heightchange).trigger(g.cellEvents.startpointychange)},getSortableOptions:function(a){var c=this,h=c.getInnerResume(),g=(c.getPhoto(h),"sortable_placeholder"),v="oldPrevItem",w=function(a,c){c.height(a.outerHeight()+"px")},b=(c.getHolderClass(),c.getGridLineClass(),$j(),function(a){var c=a.prev(".row,.section");return a.is(".row")&&0===c.length&&(c=a.parent(".section").prev(".section").find(".row:last")),c}),C=function(a,c){return a.is(".row")?c:c.find(".row")},$=function(){c.getResume().trigger(c.resumeEvents.heightchange),c.updateSortHandler()},S=function(a){c.isAnyRowAffectedByPhoto(a)&&(c.triggerPhotoRowsChange(!0,!0),c.getResume().trigger(c.resumeEvents.gridlineheightchange))},y=function(a){var h;a.is(".section")?h=c.getSectionSortHandler(a):a.is(".row")&&(h=c.getRowSortHandler(a)),h.data("disableMouseout",!0)},j=function(a){var h,g,v;a.is(".section")?(h=c.getSectionSortHandler(a),g=c.getInnerResume().find("."+c.getSectionSortRangeClassName()),v=a.children("."+c.getSortContentBoundaryClassName())):a.is(".row")&&(h=c.getRowSortHandler(a),g=c.getInnerResume().find("."+c.getRowSortRangeClassName()),v=a.children("."+c.getSortContentBoundaryClassName())),h.data("disableMouseout",!1),g.removeClass("hover"),v.hide()};return $j.extend({},{axis:"y",cursor:"ns-resize",cursorAt:{left:50},containment:".inner_resume",forceHelperSize:!0,forcePlaceholderSize:!0,opacity:!1,placeholder:g,revert:200,scroll:!0,tolerance:"pointer",change:function(a,ui){var c=ui.item,h=ui.placeholder,v=function(){var a="."+g;return function(){return c.index()>h.index()?c.prevUntil(a):c.nextUntil(a)}().add(c)}();c.insertBefore(h),S(C(c,v)),w(c,h)},start:function(a,ui){var h=ui.item,g=b(h);h.is(".row")&&h.css("width","100%"),h.data(v,g),h.removeData("emptyParent"),h.removeData("prevParent"),h.css("height","auto"),w(h,ui.placeholder),c.updateGridVisible(!1),y(ui.item)},stop:function(a,ui){c.updateGridVisible(),c.updateAllSpace(),j(ui.item)},beforeStop:function(a,ui){ui.placeholder.hide(),$(),ui.item.css("zIndex","")},update:function(a,ui){if(ui.item.is(".row")&&0===$j(this).find(ui.item).length)return ui.item.data("oldParent",$j(this)),void(0===$j(this).find(".row").length&&(ui.item.data("prevParent",c.getPrevSection($j(this))),ui.item.data("emptyParent",$j(this).detach())));var h=$j(this),g=ui.item,w=g.data(v),C=g.is(".row")?".row":".section",y=b(g),j=g.data("oldParent"),R=g.data("emptyParent"),P=g.data("prevParent"),k=function(a,c){var h,v=$j(".section"),w=$j(".row"),b=a.is(".section")||c.is(".section"),C=function(a,c,h){c=-1===c?0:c,h=-1===h?0:h;var g=[c,h].sort();return g[1]=g[1]+1,$j([].slice.apply(a,g))};return h=b?C(v,v.index(a),v.index(c)).add(g).find(".row"):C(w,w.index(a),w.index(c)).add(g)},T=k(w,y),I=function(a,h){if(0===a.length||h&&0===h.find(a).length){var v=h?h.find(C+":first").not(g):g.parent().find(C+":first").not(g);if(v.length>0)g.insertBefore(v);else{if(!R)return;h.append(g),h.insertAfter(P)}}else g.insertAfter(a);S(T),$(),c.updateAllSpace()},N=!1;c.updateResume(function(){N&&(I(y,h),R&&R.detach()),N=!0},function(){I(w,j)})}},a)},fixJQueryUISortable:function(a){a.on("sortstart",function(a,ui){var c=ui.item;c.css("left",c.offsetParent().css("paddingLeft"))}).on("sortbeforestop",function(a,ui){ui.item.css("left","")})},getHolderClass:function(){return"holder"},getGridLineClass:function(){return"grid_line"},getOutlineClass:function(){return"outline"},getCellMinWidth:function(){return 24},getCellMinWidthPercent:function(a){return 100*this.getCellMinWidth()/this.getFullWidth(a)},getFullWidth:function(a){return this.getRowTable(a).width()},toPercentWidth:function(a,c){var h=a/c*100;return h},getRowTable:function(a){var c="table:first";return a.is(".cell")?a.parents(c):a.find(c)},getPhotoAffectedCssProperty:function(a){return"padding"+this.capitalize(a)},getPhotoAffectedCssValue:function(a,c){var h=window.parseFloat(a.css(this.getPhotoAffectedCssProperty(c)+"-raw"));return window.isNaN(h)&&(h=0),h},isAffectedByPhoto:function(a){return 0!==this.getPhotoAffectedCssValue(a,"left")||0!==this.getPhotoAffectedCssValue(a,"right")},isAnyRowAffectedByPhoto:function(a){var c=this,h=!1;return $j.each(a,function(i,a){var g=$j(a);return c.isAffectedByPhoto(g)||c.isAffectedByPhoto(c.getPrevRow(g))?(h=!0,!1):void 0}),h},triggerPhotoRowsChange:function(a,c,h){var g=this,v=function(){return g.isNullable(h)&&(h=g.getPhoto()),h.trigger(g.photoEvents.rowschange),g.photoEvents.getChangedRows()}();return(a||c)&&$j.each(v.find(".cell"),function(i,h){var v=$j(h);a&&v.trigger(g.cellEvents.widthchange),c&&g.triggerCellYChange(v)}),v},resumeEvents:{widthchange:"resumewidthchange",heightchange:"resumeheightchange",gridlineheightchange:"resumegridlineheightchange"},photoEvents:{widthchange:"photowidthchange",heightchange:"photoheightchange",alignchange:"photoalignchange",rowschange:"photorowschange",dblclick:"dblclick",clearChangedRows:function(){this.changedRows=$j()},addChangedRow:function(a){this.changedRows=this.changedRows.add(a)},getChangedRows:function(){return this.changedRows}},photoPrompt:"双击设置求职照",cellEvents:{widthchange:"cellwidthchange",heightchange:"cellheightchange",startpointxchange:"cellstartpointxchange",startpointychange:"cellstartpointychange",fontsizechange:"cellfontsizechange"},rowsSizeChanged:function(a,c,h){var g=this;g.isAnyRowAffectedByPhoto(a)&&(a=a.add(g.triggerPhotoRowsChange(!c,!h))),$j.each(a.find(".cell"),function(i,a){var v=$j(a);c&&v.trigger(g.cellEvents.widthchange),h&&g.triggerCellYChange(v)}),g.getResume().trigger(g.resumeEvents.heightchange)},cellsSizeChanged:function(a,c){this.rowsSizeChanged(a.parents(".row"),!c,!0)},cellsWidthChanged:function(a){this.cellsSizeChanged(a,!1)},cellsHeightChanged:function(a){this.cellsSizeChanged(a,!0)},triggerCellYChange:function(a){var c=this;a.trigger(c.cellEvents.heightchange).trigger(c.cellEvents.startpointychange)},getSliderSpacing:function(){return{v:12,h:12}},getResumeContainerDom:function(){return $j(this.selector())},getResumeContainer:function(){return this.isNullable(this.cachedResumeContainer)&&(this.cachedResumeContainer=this.getResumeContainerDom()),this.cachedResumeContainer},getResumeDom:function(a){return this.isNullable(a)&&(a=this.getResumeContainer()),a.find(".resume")},getResume:function(a){return this.isNullable(this.cachedResume)&&(this.cachedResume=this.getResumeDom(a)),this.cachedResume},getInnerResumeDom:function(a){return this.isNullable(a)&&(a=this.getResume()),a.find(".inner_resume")},getInnerResume:function(a){return this.isNullable(this.cachedInnerResume)&&(this.cachedInnerResume=this.getInnerResumeDom(a)),this.cachedInnerResume},getPhotoDom:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".photo")},getPhoto:function(a){return this.isNullable(this.cachedPhoto)&&(this.cachedPhoto=this.getPhotoDom(a)),this.cachedPhoto},getPhotoImage:function(a){return this.isNullable(a)&&(a=this.getPhoto()),function(){var c=a.find("img");return c.length<=0&&(c=a.find("div.img")),c}()},getPhotoAlign:function(a){return this.isNullable(a)&&(a=this.getPhoto()),a.is(".left")?"left":"right"},getBorderWeight:function(a,c){var h=this.capitalize(c);return"none"===a.css("border"+h+"Style")?0:window.parseFloat(a.css("border"+h+"Width-raw"))},getPhotoAffectedHeight:function(a,c){return this.isNullable(c)&&(c=this.getPhotoImage(a)),a.outerHeight()-a.height()+c.outerHeight(!0)},getPhotoIdField:function(a){return this.isNullable(a)&&(a=this.getPhoto()),a.find("input#photo_id")},getPhotoId:function(a){return this.getPhotoIdField(a).val()},getCellTextContainer:function(a){return a.find("pre")},getCellText:function(a){return a.find("span")},getCellTextDirectly:function(a){return this.getCellText(this.getCellTextContainer(a))},getResumeSize:function(a){return this.isNullable(a)&&(a=this.getResume()),{width:window.parseFloat(a.css("width-raw")),height:window.parseFloat(a.css("minHeight-raw"))}},calculateResumePosition:function(a){var c=this,h=function(){return c.isNullable(a)&&(a=c.getResume()),a.position()}();return{top:h.top+window.parseFloat(a.css("marginTop")),left:h.left+window.parseFloat(a.css("marginLeft"))}},getResumePosition:function(a){return this.isNullable(this.cachedResumePosition)&&(this.cachedResumePosition=this.calculateResumePosition(a)),this.cachedResumePosition},getResumeMargin:function(a){var c=this,h=function(){return c.isNullable(a)&&(a=c.getInnerResume()),c.getPaddingOfMargin(a)}();return{top:window.parseFloat(a.css("marginTop-raw"))+h.top,right:window.parseFloat(a.css("marginRight-raw"))+h.right,bottom:window.parseFloat(a.css("marginBottom-raw"))+h.bottom,left:window.parseFloat(a.css("marginLeft-raw"))+h.left}},getPaddingOfMargin:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),{top:window.parseFloat(a.css("paddingTop-raw")),right:window.parseFloat(a.css("paddingRight-raw")),bottom:window.parseFloat(a.css("paddingBottom-raw")),left:window.parseFloat(a.css("paddingLeft-raw"))}},getToolbarDom:function(a){return this.isNullable(a)&&(a=this.getResumeContainer()),a.find(".toolbar")},getToolbar:function(a){return this.isNullable(this.cachedToolbar)&&(this.cachedToolbar=this.getToolbarDom(a)),this.cachedToolbar},getToolboxDom:function(a){return this.isNullable(a)&&(a=this.getResumeContainer()),a.find(".toolbox:first")},getToolbox:function(a){return this.isNullable(this.cachedToolbox)&&(this.cachedToolbox=this.getToolboxDom(a)),this.cachedToolbox},getPrevRow:function(a){var c=$(".row",this.getResumeContainer()),h=$(".row",this.getResumeContainer()).index(a);return 0===h||0>h?$():c.eq(h-1)},getPageMarkExpanded:function(){return this.getPageMark().hasClass(this.getPageMarkExpandedClassName())},getPageMarkExpandedClassName:function(){return"expanded"},getPageMark:function(){return this.prepareRuler("page_mark","horizontal",!1,!1)},updatePageMark:function(a,c){var h=this.getResume(),g=this.getPageMark(),v=this.getResumeSize(h),w=this.getResumeMargin(),b=function(){return"number"!=typeof c&&(c=a?w.bottom:w.left),c}();a?(g.css({top:v.height-b+this.units.length}),g.data("autoCheckEndPage",!0)):b>15?g.removeClass("pull-left"):g.addClass("pull-left")},togglePageMarkWarn:function(a){var c=this.getResume(),h=this.getResumeSize(c),g=this.getPageMark(),v=g.hasClass("pull-left")?h.width+20:h.width,w=this.getPageMarkExpandedClassName(),b=this,C=function(){g.animate({width:v+b.units.length},function(){$j(this).find(".warn-info").slideDown(200,function(){$j(this).find(".close").fadeIn()}),$j(this).data("autoCheckEndPage",!1)})},$=function(){g.find(".close").fadeOut(1,function(){$j(this).parent(".warn-info").slideUp(200,function(){$j(this).parent("#page_mark").animate({width:"6mm"})})})};a===!0?(g.addClass(w),C()):a===!1?(g.removeClass(w),$()):(g.toggleClass(w),g.hasClass(w)?C():$())},isEndOfPage:function(){var a=this.getInnerResume(),c=this.getPageMark();return a.offset().top+a.outerHeight()-parseFloat(a.css("paddingBottom"))>c.offset().top?!0:!1},getShowEndOfPageWarnFlag:function(){var a=this.getPageMark();return a.data("autoCheckEndPage")},getPageMarginSliderVisible:function(){return this.toolbarHelper.getCheckBoxComponentState($j("#page-margin"))},updatePageMarginSliderVisible:function(){var a=this.getResumeContainer(),c=a.find(".vertical.slider"),h=a.find(".horizontal.slider"),g=a.find(".page_margin.l"),v=a.find(".page_margin.r"),w=a.find(".page_margin.t"),b=a.find(".page_margin.b"),C=this.getPageMarginSliderVisible();C?(c.show(),w.show(),b.show(),h.show(),g.show(),v.show()):(c.hide(),w.hide(),b.hide(),h.hide(),g.hide(),v.hide())},getSectionHandleClassName:function(){return"section_handle"},getRowHandleClassName:function(){return"row_handle"},getSectionSortRangeClassName:function(){return"section-sort-range"},getRowSortRangeClassName:function(){return"row-sort-range"},getSortContentBoundaryClassName:function(){return"sort-content-boundary"},updateSortElements:function(){var a=this.getInnerResume(),c=this;a.find("."+this.getSectionHandleClassName()).remove(),a.find("."+this.getRowHandleClassName()).remove(),a.find("."+this.getSectionSortRangeClassName()).remove(),a.find("."+this.getRowSortRangeClassName()).remove(),a.find("."+this.getSortContentBoundaryClassName()).remove(),$j.each(a.find(".section"),function(i,a){var h=$j(a),g=h.find(".row");h.prepend('<div class="'+c.getSectionHandleClassName()+'"></div>'),h.prepend('<div class="'+c.getSortContentBoundaryClassName()+'"></div>'),$j.each(g,function(a,h){var g=$j(h);g.prepend('<div class="'+c.getRowHandleClassName()+'"></div>'),g.prepend('<div class="'+c.getSortContentBoundaryClassName()+'"></div>')})}),a.append($j('<div class="'+this.getSectionSortRangeClassName()+'" />')),a.append($j('<div class="'+this.getRowSortRangeClassName()+'" />')),this.updateSortHandler()},getSectionSortHandler:function(a){return a.find("."+this.getSectionHandleClassName())},getRowSortHandler:function(a){return a.find("."+this.getRowHandleClassName())},updateSortHandler:function(){var a,c,h,g,v,w,b=this.getInnerResume(),C=this.getSelectedCells(),$=this;b.find("."+$.getSectionHandleClassName()+", ."+$.getRowHandleClassName()+", ."+$.getSectionSortRangeClassName()+", ."+$.getRowSortRangeClassName()).hide(),1===C.parent().length&&(a=$.getSelectedRows(),c=a.parents(".section"),h=b.find("."+$.getRowSortRangeClassName()).show(),g=b.find("."+$.getSectionSortRangeClassName()).show(),v=a.children("."+$.getSortContentBoundaryClassName()),w=c.children("."+$.getSortContentBoundaryClassName()),$.getRowSortHandler(a).mouseover(function(){h.addClass("hover"),v.show()}).mouseout(function(){$j(this).data("disableMouseout")||(v.hide(),h.removeClass("hover"))}).show(),$.getSectionSortHandler(c).mouseover(function(){g.addClass("hover"),w.show()}).mouseout(function(){$j(this).data("disableMouseout")||(g.removeClass("hover"),w.hide())}).show())},addMinusSigh:function(){var a=this,c=this.getSelectedCells(),h=$('<span class="addMinus"></span>'),g=function(c){a.clearInserter(c),a.clearMask(c),a.clearCellInserter(c)};if(!c.length)return void $(".addMinus").remove();var v=this.getSelectedCells(c.parents(".row").last()).last();0===v.has(".addMinus").length&&($(".addMinus").remove(),$(".holder",v).append(h)),h.animate({top:"-23px",right:"0px"},500,"easeOutElastic").mousedown(function(){a.delCell()}).hover(function(){var c=a.getSelectedSections();0!==c.length&&$j.each(a.getSelectedCells(c),function(i,c){var h=$j(c);a.addMask(h,"remove")})},function(){var c=a.getSelectedSections();g(c)})},delCell:function(a){var c=this;void 0===a&&(a=this.getSelectedCells()),a.sort(function(a,c){return $(a).index(".cell")-$(c).index(".cell")});var h=[],g=[],v=[],w=[];if(0!==a.length){if(0===this.getInnerResume().find(".cell").not(a).length)return $.Noty({text:"不能删空简历",type:"error"}),void this.clearMask(this.getResumeContainer());a.parents(".section").reverse().each(function(){var g=$(this);0===g.find(".cell").not(a).length&&(h.push({section:g,prev:c.getPrevSection(g)}),a=a.not(g.find(".cell")))}),a.parents(".row").reverse().each(function(){var h=$(this),v=h.find(".cell");if(0===v.not(a).length)g.push({row:h,prev:c.getPrevRowOrContainer(h)}),a=a.not(v);else{var b=v.not(a);if(!b.is(":last-child")){var C=b.last();w.push({cell:C,width:C.prop("style").width})}}}),a.each(function(){var a=$(this);v.push({cell:a,prev:c.getPrevCell(a)})}),this.updateResume(function(){if(c.blurAllTextarea(),h.length>0)for(var i=0,a=h.length;a>i;i++)c.removeSectionWithoutUpdateResume(h[i].section);if(g.length>0){var w=$j();$j.each(g,function(i,a){w=w.add(a.row)}),c.removeRowsWithoutUpdateResume(w)}if(v.length>0){var b=$j();$j.each(v,function(i,a){b=b.add(a.cell)}),c.unSelectCells(b),c.removeCellsWithoutUpdateResume(b)}c.updateAllSpace()},function(){if(h.length>0)for(var i=0,a=h.length;a>i;i++)c.redoInsertSection(h[i].section,h[i].prev);$j.each(g,function(i,a){c.redoInsertRow(a.row,a.prev)}),c.redoInsertCells(v,function(){$j.each(w,function(i,a){a.cell.css("width",a.width)})}),c.updateAllSpace()})}},getResizeHandleClassName:function(){return"resize_handle"},getContentEditable:function(){return!0},updateContentEditable:function(){var a=this.getInnerResume(),c=this;$j.each(a.find(".section"),function(i,a){var h=$j(a);c.updateContentEditableOfSection(h,c.getContentEditable())})},updateContentEditableOfSection:function(a,c){var h=this;$j.each(a.find(".row"),function(i,a){var g=$j(a);h.updateContentEditableOfRow(g,c)})},updateContentEditableOfRow:function(a,c){var h=this;$j.each(a.find(".cell"),function(i,a){var g=$j(a);h.updateContentEditableOfCell(g,c)})},updateContentEditableOfCell:function(a,c){var h=this,g=h.getCellTextContainer(a),v=h.getCellText(g),w=$j("<textarea></textarea>"),b=null,C=function(){var c=g.position();return{width:a.width(),height:a.height(),left:c.left,top:c.top}},$=function(c){var g=C(),v=function(){return c(),C()}();g.width!==v.width&&h.cellsWidthChanged(a),g.height!==v.height&&h.cellsHeightChanged(a),g.left!==v.left&&a.trigger(h.cellEvents.startpointxchange),g.top!==v.top&&a.trigger(h.cellEvents.startpointychange)},S=function(){var a=w.val(),c=v.text(),g=a.replace(/\n|\r/g,"");if(a!==g&&w.val(g),c!==g){var b=function(a){$(function(){v.text(a)})};h.updateResume(function(){b(g)},function(){b(c)})}},y=function(c){var C=a.css("textAlign");$j(c.target).is("textarea")||(w.attr("class",v.attr("class")).attr("style",v.attr("style")).css({visibility:"visible",textAlign:C,backgroundPosition:("right"===C?"left":"right")+" bottom"}).off("blur").blur(function(){S(),v.css("visibility",""),w.val("").remove(),window.clearInterval(b)}).off("keyup").keyup(S).off("keypress").keypress(function(a){return 13===a.which?(w.blur(),!1):void 0}),h.fixTextEditor(w,g),w.prependTo(g).focus().val(v.text()),v.css("visibility","hidden"),h.getListenerAPI().notifyItemEditBegin(w.val(),h.getKeyField(a).val(),h.getKeyField(a.parents(".section")).val()))};a.off("click").find("textarea").blur(),c&&a.click(y)},fixTextEditor:function(){},getInserterClassName:function(){return"inserter"},buildInserter:function(){return $j("<div></div>").addClass(this.getInserterClassName())},clearInserter:function(a){a.find("."+this.getInserterClassName()).remove()},getMaskClassName:function(){return"mask"},addMask:function(a,c){return $j("<div />").addClass(this.getMaskClassName()).addClass("string"==typeof c?c:"").addClass("border_box").css({width:a.prop("clientWidth")+2+"px",height:a.prop("clientHeight")+2+"px"}).prependTo(a).show().offset({top:a.offset().top-1,left:a.offset().left-1})},clearMask:function(a){a.find("."+this.getMaskClassName()).remove()},getCellInserterClassName:function(){return"cell_inserter"},addCellInserter:function(a,c){return $j("<div></div>").addClass(this.getCellInserterClassName()).addClass(c?"to-left":"to-right").css(c?"left":"right","-24px").prependTo(a.find("."+this.getHolderClass()))},clearCellInserter:function(a){a.find("."+this.getCellInserterClassName()).remove()},insertVertically:function(a,c,h){return this.clearInserter(c),this.clearMask(c),h?a.insertAfter(c):a.insertBefore(c),this.clearInserter(a),this.clearMask(a),a},afterInsertVertically:function(a){this.updateSortElements(),a.find(".cell").removeClass(this.getSelectedClass())},afterInsertSection:function(a){this.bindSection(a),this.updateContentEditableOfSection(a,this.getContentEditable()),this.updateLibraryVisibleOfSection(a,this.getLibraryVisible()),this.afterInsertVertically(a),this.rowsSizeChanged(a.find(".row"),!1,!1)},afterInsertRow:function(a){this.bindRow(a),this.updateContentEditableOfRow(a,this.getContentEditable()),this.afterInsertVertically(a),this.rowsSizeChanged(a,!1,!1)},createCellOrRowOrSectionElement:function(a){return a.clone(!1)},insertRow:function(a,c){var h=this,g=h.createCellOrRowOrSectionElement(a);return h.updateResume(function(){h.insertRowWithoutUpdateResume(g,a,c)},function(){h.removeRowsWithoutUpdateResume(g)}),g},removeRowsWithoutUpdateResume:function(a){this.clearMask(a),a.remove(),this.rowsSizeChanged(a,!1,!1),this.updateSortElements(),this.updateToolbox(),this.updateAllSpace()},insertRowWithoutUpdateResume:function(a,c,h){return this.insertVertically(a,c,h),this.afterInsertRow(a),a},getPrevRowOrContainer:function(a){var c=a.prev(".row");return c.length>0?c:a.parent()},redoInsertRow:function(a,c){if(c.is(".row"))a.insertAfter(c);else{var h=c.find(".row:first");h.length>0?a.insertBefore(h):a.prependTo(c)}this.afterInsertRow(a)},insertSection:function(a,c){var h=this,g=h.createCellOrRowOrSectionElement(a);return h.updateResume(function(){h.insertVertically(g,a,c),h.afterInsertSection(g)},function(){h.removeSectionWithoutUpdateResume(g)}),g},removeSectionWithoutUpdateResume:function(a){this.clearMask(a),a.remove(),this.rowsSizeChanged(a.find(".row"),!1,!1),this.updateToolbox(),this.updateAllSpace()},getPrevSection:function(a){var c=a.prev(".section");return c.length>0?c:this.getPhoto()},redoInsertSection:function(a,c){a.insertAfter(c),this.afterInsertSection(a)},afterInsertCells:function(a){var c=this,h=a.parents(".row");a.removeClass(this.getSelectedClass()),h.each(function(i,a){c.bindRow($j(a))}),this.rowsSizeChanged(h,!1,!1),a.each(function(i,a){c.updateContentEditableOfCell($j(a),c.getContentEditable())}),this.updateToolbox()},insertCells:function(a,c){var h=this,g=$j(),v=[],w=function(a,g){g.css("width",""),h.clearCellInserter(a),c?g.insertBefore(a):g.insertAfter(a),h.clearCellInserter(g)};return a.each(function(i,a){var c=h.createCellOrRowOrSectionElement($j(a));h.getCellTextDirectly(c).text(""),h.getKeyField(c).val(""),g=g.add(c)}),$j.each(a.parent().find(".cell"),function(i,a){var c=$j(a);v.push({cell:c,width:c.prop("style").width})}),h.updateResume(function(){$j.each(g,function(i,c){w($j(a[i]),$j(c))}),h.afterInsertCells(g)},function(){h.removeCellsWithoutUpdateResume(g,function(){$j.each(v,function(i,a){a.cell.css("width",a.width)})})}),g},removeCellsWithoutUpdateResume:function(a,c){var h=this,g=a.parents(".row");this.clearMask(a),a.remove(),this.notNullable(c)&&c(),$j.each(g,function(i,a){var c=$j(a),g=c.find(".cell:last");g.length>0&&h.bindCell(g)}),this.rowsSizeChanged(g,!0,!0),this.updateSortElements(),this.updateToolbox(),this.updateAllSpace()},getPrevCell:function(a){var c=a.prev(".cell");return c.length>0?c:a.parent()},redoInsertCells:function(a,c){var h=$j();$j.each(a,function(i,a){var c=a.cell,g=a.prev;g.is(".cell")?c.insertAfter(g):c.prependTo(g),h=h.add(c)}),this.notNullable(c)&&c(),this.afterInsertCells(h)},getPhotoEditable:function(){return this.getPhotoSettingComponent().hasClass("active")},updatePhotoImage:function(a,c){var h=this.getPhoto(),g=this.getPhotoIdField(h),v=g.val(),w=this.getPhotoImage(h),b=this,C=$j.trim(a),$=$j.trim(c),S=function(a,c){var v="hidden",w=c.is("img"),C=b.getPhotoImage(h);g.val(a),c.appendTo(h),C.remove(),w?h.removeClass(v):h.addClass(v),C.is("img")!==w&&(b.triggerPhotoRowsChange(!0,!0,h),b.getResume().trigger(b.resumeEvents.heightchange),b.updateToolbox())};if(C!==v){var y=""===$?$j("<div></div>").addClass("img").attr("style",w.attr("style")):$j("<img />").attr({src:$,style:w.attr("style")});b.updateResume(function(){S(C,y),$j.jobPhoto().selectPhotoById(b.getPhotoId())},function(){S(v,w),$j.jobPhoto().selectPhotoById(b.getPhotoId())})}},getGridVisible:function(){return this.toolbarHelper.getCheckBoxComponentState($j("#grid"))},updateGridVisible:function(a){var c=this.getGridVisible(),h=this.getResume(),g="grid";a="boolean"==typeof a?a:c,h.removeClass(g),a&&h.addClass(g)},isCJK:function(){var a=$("#isCJK").val();return"true"===a?1:"false"===a?2:0},getLibraryVisible:function(){return this.toolbarHelper.getCheckBoxComponentState($j("#library"))},updateLibraryVisible:function(){var a=this.getInnerResume(),c=this.getLibraryVisible(),h=this;$j.each(a.find(".section"),function(i,a){var g=$j(a);h.updateLibraryVisibleOfSection(g,c)})},getLibraryArrowClassName:function(){return"library_arrow"},updateLibraryVisibleOfSection:function(a,c){var h=this,g=function(c,g){return h.isNullable(g)&&(g=a),g.find(h.keyFieldByValueSelector(c)).parents(".cell").reverse()},v=h.getKeyField(a).val(),w="library-change",b=h.getLibraryArrowClassName(),C=$j("<div />").addClass(w),S=$j('<button class="up" />').addClass(b),y=$j('<button class="down" />').addClass(b).hide(),j=$j('<button class="list" />').attr("title","打开列表").hide(),R={section:a,type:v,arrows:[S,y],component:C},P=function(c){var g=c.getKey();a.prepend(C.append(S.addClass(g)).append(j).append(y.addClass(g))),h.bindHoverWithDelay(a,function(){c.showArrows()},function(){c.hideArrows()},200,200,[h.getRowHandleClassName(),h.getSectionHandleClassName()])};a.off("mouseenter mouseleave").find("."+w).remove(),c&&"experience"===v&&g("content").length>0&&h.applyFunction(function(){var a=[];return h.getLibraryAPI($j.extend({},R,{mark:a,params:{c:JSON.parse($j("input#resume_category").val()),t:a,l:h.isCJK()},extractSectionToRecord:function(){return{title:h.getCellTextDirectly(g("title").first()).text(),subtitle:h.getCellTextDirectly(g("subtitle").first()).text(),content:$j.map(g("content"),function(a){var c=$j(a);return h.getCellTextDirectly(c).text()})}},fillRecordToSection:function(a){var c=h.isNullable(a)?{}:a,v=function(){var a=c.content;return h.isNullable(a)?[]:a.slice(0)}(),w=g("title").first(),b=g("subtitle").first(),C=g("content"),$=$j().add(w).add(b).add(C),S=null;for(h.getCellTextDirectly(w).text(c.title),h.getCellTextDirectly(b).text(c.subtitle),$j.each(C,function(i,a){var c=$j(a),g=h.getCellTextDirectly(c);v.length>0?g.text(v.shift()):c.siblings($j.map(["title","subtitle"],function(a){return".cell:has("+h.keyFieldByValueSelector(a)+")"}).join(",")).length>0?g.text(""):c.parents(".row").remove()});C.length>0&&v.length>0;)$j.each(g("content",function(){return h.isNullable(S)&&(S=C.last().parents(".row")),h.insertRowWithoutUpdateResume(h.createCellOrRowOrSectionElement(S),S,!0)}()),function(){return function(i,a){var c=$j(a);h.getCellTextDirectly(c).text(function(){var a=v.shift();return h.isNullable(a)&&(a=""),a}()),$=$.add(c)}}());h.cellsHeightChanged($)}}))}(),function(){var a=this;P(a),a.updateArrows(),S.off("click").click(function(){$(".addMinus").remove(),a.showPrev()}),y.off("click").click(function(){$(".addMinus").remove(),a.showNext()}),j.off("click").click(function(){a.showList()})})},getLibraryAPI:function(a){var c=this;return LibraryAPI($j.extend({},{toggleArrowDuration:200,disabledClassName:"disabled",sharePosition:!1,showArrows:function(){var a=this,c=a.component;c.show().find("button").each(function(i,c){var h=$j(c);h.hasClass(a.disabledClassName)||h.fadeIn(a.toggleArrowDuration),h.hasClass("up")?h.animate({top:0,left:40},{queue:!1,duration:a.toggleArrowDuration}):h.hasClass("list")?h.animate({left:42},{queue:!1,duration:a.toggleArrowDuration}):h.hasClass("down")&&h.animate({top:72,left:40},{queue:!1,duration:a.toggleArrowDuration})})},hideArrows:function(){var a=this,c=a.component;c.find("button").each(function(i,h){var g=$j(h);g.fadeOut(a.toggleArrowDuration),g.hasClass("up")?g.animate({top:38,left:0},{queue:!1,duration:a.toggleArrowDuration}):g.hasClass("list")?g.animate({left:0},{queue:!1,duration:a.toggleArrowDuration,complete:function(){c.hide()}}):g.hasClass("down")&&g.animate({top:38,left:0},{queue:!1,duration:a.toggleArrowDuration})})},enableArrow:function(a){a.removeClass(this.disabledClassName)},disableArrow:function(a){a.addClass(this.disabledClassName)},updateNextArrow:function(a,h){var g=this.getData(),v=h[0],w=g[v];c.isNullable(w)&&(w=[]),v<g.length-1||h[1]<w.length-1?this.enableArrow(a):this.disableArrow(a),!this.isLoading()&&!this.isEmpty()&&g.length-1-v<=0&&this.loadData()},updatePrevArrow:function(a,c){c[0]<=0&&c[1]<=0?this.disableArrow(a):this.enableArrow(a)},updateArrows:function(){var a=this.getPosition();this.updatePrevArrow(this.arrows[0],a),this.updateNextArrow(this.arrows[1],a)},showNext:function(){var a=this.getPosition(),h=this.getData(),g=a[0],v=a[1],w=[g,v+1],b=h[g];if(c.isNullable(b)&&(b=[]),v>=b.length-1){if(!(g<h.length-1))return void this.updateArrows();w=[g+1,0]}this.transition(w,!0)},showPrev:function(){var a=this.getPosition(),h=this.getData(),g=a[0],v=a[1],w=[g,v-1];if(0>=v){if(!(g>0))return void this.updateArrows();w=function(){var a=g-1,v=h[a];return c.isNullable(v)&&(v=[]),[a,Math.max(v.length-1,0)]}()}this.transition(w,!1)},updateSection:function(a){var h=this,g=h.section.height(),v=function(){return h.section.find(".row")},w=function(a){return a.map(function(){var a=$j(this);return a.find(".cell").map(function(){var a=$j(this);return{cell:a,text:c.getCellTextDirectly(a).text()}})})},b=h.getPrivatePosition(),C=function(a,g){if(h.setPosition(a),h.sharePosition)$j.each(c.getInnerResume().find("."+c.getLibraryArrowClassName()+"."+h.getKey()),function(i,c){var g=$j(c);g.is(".r")?h.updateNextArrow(g,a):g.is(".l")&&h.updatePrevArrow(g,a)});else if(h.updateArrows(),g){var v=function(a){return h.section.find("."+c.getLibraryArrowClassName()+"."+a)};h.updatePrevArrow(v("l"),a),h.updateNextArrow(v("r"),a)}},$=v(),S=w($);h.setRecord(b,h.extractSectionToRecord()),h.fillRecordToSection(h.getRecord(a)),c.unSelectAllCells(h.section),C(a,!1);var y=v(),j=w(y),R=function(a,g){var w=v();c.removeRowsWithoutUpdateResume(w.not(a)),h.section.append(a),$j.each(g,function(i,a){$j.each(a,function(a,h){c.getCellTextDirectly(h.cell).text(h.text)})});var b=a.not(w);c.rowsSizeChanged(a.not(b),!1,!0),$j.each(b,function(i,a){c.afterInsertRow($j(a))}),c.getExposeSectionPopup(h.section).clearUpExposeElements()},P=!1;return c.updateResume(function(){P&&(R(y,j),C(a,!0)),P=!0
},function(){R($,S),C(b,!0)}),[g,h.section.height()]},transitionDuration:400,transition:function(a,c){return this.transitionWithAnimate(a,c)},transitionWithAnimate:function(a,h){var g=this,v=function(){return $j.each(g.arrows,function(i,a){a.prop("disabled",!0)}),"hidden"}(),w=function(){return g.section.clone(!1).removeAttr("style").removeAttr("class")},b=g.section.width(),C=w(),$=g.updateSection(a),S=$[0],y=$[1],j=w(),R=g.section.children().addClass(v),P=$j('<div class="library_transition_stage"></div>').width(b).height(S).append('<div class="l '+c.getGridLineClass()+'"></div>').append(C).append(j.css({top:(h?S:0-y)+"px"})).appendTo(g.section),k=function(){P.remove(),R.removeClass(v),$j.each(g.arrows,function(i,a){a.prop("disabled",!1)})};return c.simulateFakeThread(function(){C.animate({top:h?0-S:y+"px"},g.transitionDuration),j.animate({top:0},g.transitionDuration),P.animate({height:y+"px"},{duration:g.transitionDuration,complete:k})}),$},getListPopup:function(){var a=this;return c.isNullable(a.listPopup)&&(a.listPopup=c.getExposeSectionPopup(a.section)),a.listPopup},setListPopupLoadingVisible:function(a){var c=this.getListPopup().getElement().find(".loading");c.length>0&&(a?c.show():c.hide())},addBatchToList:function(a,h){var g=this,v="selected",w=g.getListPopup(),b=w.getElement(),C=b.find("."+g.containerClassName),$=C.find("."+g.recordsClassName);$.length<=0||(c.isNullable(h)&&(h=[]),$j.each(h,function(h,S){var y=[a,h],j=g.getItemOfRecords(y);c.notNullable(j)&&(S=j),c.isNullable(S)||$j('<div class="record" title="点击替换"></div>').append($j('<div class="record_title"></div>').append($j('<div class="right"></div>').text(S.subtitle)).append($j("<span></span>").text(S.title))).append(function(){var a=$j('<ul class="record_content"></ul>');return $j.each(S.content,function(c,h){a.append($j("<li></li>").text(h))}),a}()).off("click").click(function(){var c=$j(this),S=$j.map(g.arrows,function(a){return a.prop("disabled")});if(!S[0]&&!S[1])return function(){var S=$j(document).height(),j=g.getPosition(),R=j[0],P=g.transition(y,a>R||a===R&&h>j[1]),k=P[1],T=k-P[0];C.height(Math.max(C.height()-T,g.popupContainerMinHeight)),w.locate(k,S+T,b.position().top>g.section.offset().top,g.transitionDuration,g.transitionDuration),$.find("."+v).removeClass(v),c.addClass(v)}()}).addClass(function(){var c=g.getPosition();return a===c[0]&&h===c[1]}()?v:"").appendTo($)}))},containerClassName:"container",recordsClassName:"records",popupContainerMinHeight:300,popupContainerMaxHeight:600,recordContentVisible:!1,showList:function(){var a=this,c=a.getListPopup(),h=50,g="simple",v=$j("<div></div>").addClass(a.containerClassName).height(Math.min(Math.max($j(window).height()-a.section.height()-2*h,a.popupContainerMinHeight),a.popupContainerMaxHeight)).append($j("<div></div>").addClass(a.recordsClassName)).append($j('<div class="loading" title="正在加载 ..."></div>').html('<div class="img"></div>')).addClass(a.recordContentVisible?"":g),w=function(){return(v.hasClass(g)?"展开":"收起")+"详细内容"},b=function(){return v.scrollTop()<=0},C=function(){return v.scrollTop()+v.outerHeight()>=v.prop("scrollHeight")},$=function(){a.isLoading()||a.isEmpty()||!C()||a.loadData()},S="DOMMouseScroll mousewheel";c.setContent(v.off("scroll").scroll(function(){$()}).off(S).on(S,function(a){var c=a.originalEvent,h=0;return c.wheelDelta&&(h=c.wheelDelta/120),c.detail&&(h=(0-c.detail)/3),h>0&&b()||0>h&&C()?!1:void 0}).add($j('<div style="margin: 6px 0 -6px; text-align: center;"></div>').append(c.createCancelLink("<span>完成</span>").addClass("small button")).append($j('<a href="#" style="margin-left: 30px;"></a>').html(w()).off("click").click(function(){return v.toggleClass(g),$j(this).html(w()),$(),a.recordContentVisible=!v.hasClass(g),!1})))),$j.each(a.getData(),function(c,h){a.addBatchToList(c,h)}),c.show(),function y(){var c;v.prop("clientHeight")&&v.prop("scrollHeight")<=v.prop("clientHeight")&&!a.isEmpty()?($(),c=window.setTimeout(function(){y()},1e3)):window.clearTimeout(c)}()},onLoadDataSuccess:function(a,h){var g=this;g.addBatchToList(a,h),$j.each(c.getInnerResume().find(".down."+c.getLibraryArrowClassName()+"."+g.getKey()),function(i,a){var c=$j(a);g.enableArrow(c)})},toggleDataLoadingIndicator:function(a){this.setListPopupLoadingVisible(a)},getHeadRecord:function(){var a="headRecord",c=this.section.data(a);return this.isNullable(c)&&(c=this.extractSectionToRecord(),this.section.data(a,c)),c},section:$j(),arrows:[$j(),$j()],fillRecordToSection:function(){},extractSectionToRecord:function(){return{}}},a))},getSelectedClass:function(){return"ui-selected"},unSelectCells:function(a){var c=this,h=c.getSelectedClass(),g=a.filter("."+h);g.length>0&&(g.removeClass(h),c.getResume().selectable("option","stop")(),c.getResume().selectable("option","unselecting")(null,{unselecting:a}))},unSelectAllCells:function(a){this.isNullable(a)&&(a=this.getInnerResume()),this.unSelectCells(a.find(".cell"))},getSelectedCells:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".cell."+this.getSelectedClass())},getSelectedRows:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".row:has(.cell."+this.getSelectedClass()+")")},getSelectedSections:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".section:has(.cell."+this.getSelectedClass()+")")},getCellOutlinedClass:function(){return"outlined"},getOutlinedCells:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".cell."+this.getCellOutlinedClass())},getSelectedPhoto:function(a){return this.isNullable(a)&&(a=this.getInnerResume()),a.find(".photo."+this.getSelectedClass()+":has(img)")},mergeMarginAndBorderFormats:function(a,c,h){var g=this;$j.each(["Top","Right","Bottom","Left"],function(i,v){var w="margin"+v,b="data-margin-"+v.toLowerCase(),C="border"+v+"Style",$="border"+v+"Width",S="border"+v+"Color";a[w]=window.parseFloat(c.attr(b)||c.css(w+"-raw")),a[C]=h.css(C),a[$]=window.parseFloat(h.css($+"-raw")),a[S]=g.getColorValueOfCss(h.css(S))})},mergeBackgroundColorFormat:function(a,c){a.backgroundColor=this.getColorValueOfCss(c.css("backgroundColor"))},getCellFormats:function(a){var c=this,h=c.getCellTextContainer(a),g=c.getCellText(h),v=function(a,c){return $j.trim($j.trim(a).split(c,1)[0])},w={fontName:v(v(c.trimQuote(g.css("fontFamily")),",")," "),fontSize:window.parseFloat(g.css("fontSize-raw")),fontColor:c.getColorValueOfCss(g.css("color")),fontHighlight:c.getColorValueOfCss(g.css("backgroundColor")),fontBold:function(){var a=g.css("fontWeight-raw");return"normal"!==a}(),fontItalic:"normal"!==g.css("fontStyle"),fontUnderline:g.css("textDecoration").indexOf("underline")>=0,horizontalAlign:a.css("textAlign"),verticalAlign:a.css("verticalAlign"),width:a.css("width-raw"),lineHeight:window.parseFloat(g.attr("data-line-height"))};return c.mergeBackgroundColorFormat(w,a),c.mergeMarginAndBorderFormats(w,h,a),w},getPhotoFormats:function(a){var c=this,h=c.getPhotoImage(a),g={photoAlign:c.getPhotoAlign(a)};return c.mergeBackgroundColorFormat(g,a),c.mergeMarginAndBorderFormats(g,h,a),g},formatHelper:{multipleValuesIndicator:{},getMultiple:function(){return this.multipleValuesIndicator},isMultiple:function(a){return this.multipleValuesIndicator===a}},updateToolbox:function(){var i,a=this.toolbarComponents;for(this.initSelectObj(),i=0;i<a.length;i++)a[i].refreshComponent()},selectedObj:null,initSelectObj:function(){var a=this.getSelectedCells(),c=this.getCellTextContainer(a),h=this.getCellText(c),g=this.getSelectedPhoto(),v=this.getPhotoImage(g);this.selectedObj=null,this.selectedObj={cell:a,textContainer:c,text:h,photo:g,img:v}},keyFieldSelector:"input[name=key]",keyFieldByValueSelector:function(a){return this.keyFieldSelector+"[value="+a+"]"},getKeyField:function(a){return a.children(this.keyFieldSelector+":first")},ResumeDarkOverlayPopup:$j.extend({},DarkOverlayPopup),getExposeSectionPopup:function(a){var c=this;return $j.extend({},c.ResumeDarkOverlayPopup,{modalOverlay:$j.extend({},BaseOverlay,{color:"transparent",opacity:"0",zIndex:"100001"}),getExposeElements:function(){return a.find(".row table")},darkOverlayOptions:{opacity:"0.5",duration:function(){return 300}},classNames:["popup","plain"],clearUpExposeElements:function(){return this.getExposeElements().css({position:"",backgroundColor:"",zIndex:""})},beforeShow:function(){c.Hotkeys.disable(),this.modalOverlay.show(),this.getExposeElements().css({position:"relative",backgroundColor:"#fff",zIndex:"100000"}).find(".outline, .resize_handle, .fake-resize-icon").addClass("unseen"),$(".addMinus").addClass("unseen"),this.getElement().css({width:a.width()+"px",borderStyle:"dashed",borderColor:"#efefef",borderWidth:"1px 0"})},beforeHide:function(){c.Hotkeys.enable(),this.modalOverlay.hide(),this.clearUpExposeElements().find(".outline, .resize_handle, .fake-resize-icon").removeClass("unseen"),$(".addMinus").removeClass("unseen"),c.clearMask(a)},afterShow:function(){this.locate(a.height(),$j(document).height(),!0,400,-1)},locate:function(c,h,g,v,w){var b=this.getElement(),C=0,$=$j(window).height(),S=b.outerHeight(),y=Math.max(5,($-c-C-S)/2),j=a.offset(),R=j.top,P=j.left,k=h-$,T=function(){var a=function(){var a=R-y;return g=!0,0>a&&(a=0),a>k?-1:a},v=function(){var a=R+c+y-$;return g=!1,0>a?-1:a},w=g?[a,v]:[v,a],b=w[0]();return 0>b&&(b=w[1](),0>b&&(g=(h-c)/2>R,b=g?k:0)),b}(),I=function(){return g?R+c+C:R-C-S};v>0?$j("html, body").animate({scrollTop:T},{duration:v}):$j("html, body").scrollTop(T),w>0?b.animate({top:I(),left:P},{duration:w}):b.css({top:I()+"px",left:P+"px"})}})},updateResume:function(a,c){var h=this.Undo.createCommand(a,c),g=h.redo();return this.Undo.push(h),g},updateSelected:function(a,c){var h=this,g=[];if($j.each([{howto:a,getSelected:function(){return h.getSelectedCells()}},{howto:c,getSelected:function(){return h.getSelectedPhoto()}}],function(i,a){var c=a.howto;if(h.notNullable(c)){var v=a.getSelected();if(v.length>0){var w=c[0](v);h.notNullable(w)&&g.push({selected:v,memo:w,redo:c[1],undo:c[2]})}}}),g.length>0){var v=function(a){$j.each(g,function(i,c){c[a?"undo":"redo"](c.selected,c.memo)}),h.updateToolbox()};h.updateResume(function(){v(!1)},function(){v(!0)})}},fixTextInput:function(a){a.css("paddingRight",function(){var c=window.parseFloat(a.css("paddingRight"));return window.isNaN(c)&&(c=0),c+1}()+"px").keypress(function(c){return 13===c.which?(a.change(),!1):void 0})},collectButtonSetValues:function(a,c){var h=$j("#"+a),g={};return $j.each(c,function(i,c){g[c]=h.find("input#"+a+"_"+c).is(":checked")}),g}})}}),OnlineDrawer=$j.extend({},BaseDrawer,{selector:function(){return"#online_drawer"},afterBind:function(a){this.usersChanged(a)},afterDrag:function(a){this.usersChanged(a)},afterExpand:function(a){this.chatsChanged(this.getChats(a))},usersChanged:function(a){var c=Helper.isNullable(a)?$j(this.selector()):a,h=c.find(".users"),g=.3*c.height(),v=h.find("ul"),w=v.find("li").length,b=w>0?v.outerHeight():0;$j("#users_count").text(w),b>g&&(b=g),h.height(b),this.getChats(c).css("top",b+"px")},postInit:function(a,c,h){this.bindWindowUnload(a,c),this.bindChatInput(h)},bindWindowUnload:function(a,c){$j(window).unload(function(){Helper.sendSyncAjax(a,c)})},bindChatInput:function(a){var c=$j(this.selector()).find(".chat_input textarea");c.off("keypress").keypress(function(h){return 13===h.which?function(){var h=c.val();return""!==$j.trim(h)&&(a(h),c.val("")),!1}():void 0})},onChatFailed:function(a,c){var h=this.getChats();h.append($j('<div class="failed"></div>').append("<div>发送失败：</div>").append($j('<div class="message"></div>').text(a)).append($j('<div class="reason"></div>').html(c))),this.chatsChanged(h),this.attractAttention()},getChats:function(a){return Helper.isNullable(a)&&(a=$j(this.selector())),a.find(".chats")},chatsChanged:function(a){Helper.isNullable(a)&&(a=this.getChats()),a.scrollTop(a.prop("scrollHeight"))}}),ResumeRecomJob=$.extend({},Base,{popType:null,jobInfo:null,init:function(){var a,c,h,g=this,v=200,w=$(".sider-bar .sider_job");this.recomJobPopup=function(b){var C,S=$.extend({},OverlayPopup,{classNames:["popup","recommend-popup editor-recommend"],trigerHeight:0,tirgerWidth:0,overlayOptions:function(){return{opacity:"0.1"}},show:function(){var a,c="editor-recommend-first-"+Resume.getResumeId();0===b?(this.getOverlay().show(),this.add(),a=this.getElement().css("top","14%").show(),this.trigerHeight=a.outerHeight(),this.tirgerWidth=a.outerWidth(),this.guideShow(a)):"true"!==Cookie.get(c)&&(this.getOverlay().show(),this.add(),a=this.getElement().css("top","14%").show(),this.trigerHeight=a.outerHeight(),this.tirgerWidth=a.outerWidth(),this.firstShow(a),Cookie.set(c,"true",{path:"/",expires:2592e6}))},firstShow:function(h){var g=h.offset().top,v=h.offset().left,b=$(document).scrollTop();a=$("<div></div>").addClass("guide-ball green"),c=$("<div></div>").addClass("guide-circle"),$("body").append(a).append(c);var C=a.width(),S=c.outerWidth(),y=w.outerWidth(),j=w.offset().left+y/2-S/2,R=w.offset().top-$(document).scrollTop()+y/2-S/2;a.css({top:g-b+this.trigerHeight/2-C/2,left:v+this.tirgerWidth-C/2}),c.css({left:j,top:R,opacity:0}),this.drawLine(a,c)},hide:function(){var h=this.getElement();this.beforeHide(),0===b?this.guideHide(h):(h.remove(),this.getOverlay().hide(),a.remove(),c.remove()),this.afterHide()},drawLine:function(a,c){var h=a.offset().left,g=a.offset().top,v=c.offset().left,w=c.offset().top,b=Math.sqrt((v-h)*(v-h)+(w-g)*(w-g)),C=Math.asin(Math.abs(w-g)/b)/(Math.PI/180);g>w&&(C=-C);var S=$("<div></div>").addClass("line");a.append(S),S.css({transform:"rotate("+C+"deg)"}),S.animate({width:b},1e3,function(){c.animate({opacity:1},400)})},guideShow:function(c){var g=this,w=c.offset().top,b=c.offset().left,C=a.width(),S=$(document).scrollTop();c.css({marginTop:this.trigerHeight/2,height:0}),a.append(h).stop().animate({top:w-S+g.trigerHeight/2-C/2,left:b+g.tirgerWidth-C/2},v+200,function(){h.stop().animate({width:g.tirgerWidth},v,function(){a.stop().animate({opacity:0},v),c.stop().animate({marginTop:0,height:g.trigerHeight},v)})})},guideHide:function(c){var g=this;a.stop().animate({opacity:1},v),c.stop().animate({marginTop:g.trigerHeight/2,height:0},v,function(){h.stop().animate({width:0},v,function(){a.stop().animate({left:w.offset().left,top:w.offset().top-$(document).scrollTop()},v+200,function(){a.remove(),c.remove(),g.getOverlay().hide()})})})}});("seekJob"===g.popType||"job"===g.popType)&&(C=Handlebars.compile($("[data-template-name=job-popup]").html()),S.setContent(C({popType:g.popType,content:g.jobInfo})),S.getContentElement().find(".close-popup").click(function(){S.hide()}),S.show(),PieChart.enable())},Handlebars.registerHelper("equal",function(a,c,h){return a===c?h.fn(this):h.inverse(this)}),w.click(function(e){var c=e.clientX,v=e.clientY;a=$("<div></div>").addClass("guide-ball"),h=$("<div></div>").addClass("line"),$("body").append(a);var w=a.height(),b=a.width();a.css({left:c-b/2,top:v-w/2}),g.recomJobPopup(0)})}}),ResumeEditorTipsPanel=$j.extend({},Base,TipsPanel,{otherStyles:function(){var a=function(a,c){var h=window.parseInt(a.css(c));return window.isNaN(h)?0:h},c=$j(".resume");return{marginTop:0-a(c,"marginBottom")+"px",marginLeft:a(c,"marginLeft")+a(c,"borderLeftWidth")+"px",marginBottom:0-a($j(".page_footer"),"marginTop")+"px"}}(),getConstant:function(){if(Helper.isNullable(this.cons)){var a=function(a,c){return'<a href="'+c+'" target="_blank">'+a+"</a>"},c=function(c,h){return a(c,"/knowledge/articles/"+h)};this.cons={pageMark:["删减不重要的内容，调整文字大小和行距，将简历控制在一页以内。"+c("为什么？怎么做到？","5159332c0cf2763fd0e6a5ce")],order:["内容按重要性排序：与岗位针对性越强的内容，放在越靠前的位置。"+c("怎么做？","51c2acea0cf29634e66937da")],afterSaved:["这份简历可以投递了么？还可以提高么？"+c("快去对照《简历自检表》检查一遍。","51c2ad820cf29634e66937e1")],photoEdit:["如果没有合适的求职照，宁可不放照片。"+c("要不要放求职照？","51bdc65f0cf2e3a2c23f95d4"),"求职照应既体现出职业感，又体现出积极阳光的精神面貌。"+c("好求职照应该什么样？","51c2ac780cf29634e66937d6")],pageHeader:["不要在页眉出现“简历”字样，不要放学校 logo"+c("天哪！为什么？","51c2ad260cf29634e66937df")],byItemKey:{bullet:["多种项目符号会使排版显得混乱，建议仅使用一种项目符号，推荐圆点 • "],period:["使用统一的日期格式，建议符合阅读习惯，比如 2013-03-27"+c("正确格式和常见错误。","51b992ae0cf27180ee1f8fff"),"内容按照重要性排序，未必一定保持时间倒序。"]},bySectionKey:{profile:["个人信息并不是越多越好，主要为了让企业联系到你。"+c("该写哪些个人信息？","515951580cf2763fd0e6a612")],experience:["措辞：具体、简洁、条理，让人容易读懂并发现你的竞争力。"+c("怎么写好经历？","51b9308e0cf27180ee1f8ed0"),"挖掘：针对岗位，每一件小事都可以写得很有价值。"],intent:["求职意向是简历的灵魂，一定要明确而具体。"+c("怎么写清求职意向？","51c2acfa0cf2cf1a69403acd")],education:["教育背景要至少包含“学校”、“专业”、“学历”和”毕业时间“四项。"+c("注意事项。","51be92260cf2e3a2c23f96a5"),"奖学金、好成绩都会为你加分。"+c("还有什么可以写在教育背景里？","51be8be00cf2e3a2c23f9689")],skill:["针对岗位的技能，可以放在教育背景下，或专门突出。"+c("哪些技能证书要突出？哪些要弱化？","51be84360cf2e3a2c23f9673"),"写清技能证书的“含金量”，突出你的优势。"+c("参考《技能证书指导大全》","51beb5550cf2e3a2c23f96f7")],honor:["同类型奖励不用逐条列举，写清获得次数和含金量即可。"+c("怎么写？","51c2abe50cf2cf1a69403ac8"),"“奖学金”可以放到教育背景下面，“优秀团干部”可以放到经历里甚至不写。"+c("为什么？","51c2ad7b0cf2cf1a69403acf")],hobby:["特长爱好不用多，选1-2项与应聘岗位相关的，写清楚。"+c("怎么写特长和爱好？","51a8567c0cf261cc41d212d1")]},buSectionAndItemKey:{profile:{phone:["手机号码按照 3-4-4 的格式填写，以方便 HR 阅读。","如果是跨地域求职，可在手机号码后注明所属地，比如 138-0013-8000（上海）"],email:["使用知名公共邮箱，如 163、sina 等，以免邮件被拒收或归为垃圾邮件。","尽量选择严肃、职业的邮箱地址和昵称，“卡哇伊”、“氺橸の纞”等会显得不够成熟。"]}}}}return this.cons},bindEvent:function(){var a=this,c="tipsPanel";$j("#page_mark").off("mouseenter."+c).on("mouseenter."+c,function(){a.setContent(a.getConstant().pageMark)}),$j(document).off("mousedown."+c,".section_handle, .row_handle").on("mousedown."+c,".section_handle, .row_handle",function(){a.setContent(a.getConstant().order)}),$j(".photo").off("click."+c).on("click."+c,function(){a.setContent(a.getConstant().photoEdit)}),$j(".resume").off("mousedown."+c).on("mousedown."+c,function(c){var h=$j(".inner_resume");c.pageY-h.offset().top-window.parseFloat(h.css("padding-top"))<0&&a.setContent(a.getConstant().pageHeader)}),this.getElement().click(function(e){e.stopPropagation()}),Resume.addListener(c,{onAfterSaved:function(){a.setContent(a.getConstant().afterSaved)},onItemEditBegin:function(c,h,g){var v=function(c,h){var g=a.getConstant(),v=g.byItemKey[h];if(Helper.notNullable(v))return v;var w=g.bySectionKey[h];if(Helper.notNullable(w))return w;var b=g.buSectionAndItemKey[c];if(Helper.notNullable(b)){var C=b[h];if(Helper.notNullable(C))return C}var $=g.bySectionKey[c];return Helper.notNullable($)?$:null},w=v(g,h);Helper.notNullable(w)&&a.setContent(w)},onPhotoEdit:function(){a.setContent(a.getConstant().photoEdit)}})}});